{% extends 'gravity/admin/base_admin.html' %}

{% block title %}{% if clase %}Editar{% else %}Crear{% endif %} Clase - Panel de Administración{% endblock %}

{% block breadcrumb %}
    <li class="flex items-center">
        <span class="text-gray-400">/</span>
        <a href="{% url 'gravity:admin_clases_lista' %}" class="ml-1 text-principal hover:text-principal/80 transition-colors duration-200">
            Clases
        </a>
    </li>
    <li class="flex items-center">
        <span class="text-gray-400">/</span>
        <span class="ml-1 text-gray-500">Crear</span>
    </li>
{% endblock %}

{% block content %}
    {% load static %}
    <!-- Header Section -->
    <div class="grid grid-cols-1 mb-6">
        <div class="col-span-1">
            <div class="card">
                <div class="p-6">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div class="md:w-1/2">
                            <h2 class="text-2xl font-bold text-principal mb-2 flex items-center">
                                <svg class="size-8 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    {% if clase %}
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    {% else %}
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    {% endif %}
                                </svg>
                                {% if clase %}Editar{% else %}Crear{% endif %} Clase
                            </h2>
                            <p class="text-gris-medio mb-0">
                                {% if clase %}
                                    Modifica los datos de la clase existente
                                {% else %}
                                    Completa los datos para crear una nueva clase
                                {% endif %}
                            </p>
                        </div>
                        <div class="md:w-1/2 text-right mt-4 md:mt-0">
                            <a href="{% url 'gravity:admin_clases_lista' %}" class="inline-flex items-center border border-principal text-principal hover:text-fondo hover:bg-principal font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                </svg>
                                Volver a Lista
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Section -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <div class="lg:col-span-8">
            <div class="card">
                <div class="card-header border-b border-gray-200 p-6">
                    <h5 class="text-xl font-semibold text-blanco flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="size-6 mr-1 mb-0.5">
                            <path d="M224 64C241.7 64 256 78.3 256 96L256 128L384 128L384 96C384 78.3 398.3 64 416 64C433.7 64 448 78.3 448 96L448 128L480 128C515.3 128 544 156.7 544 192L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 192C96 156.7 124.7 128 160 128L192 128L192 96C192 78.3 206.3 64 224 64zM160 304L160 336C160 344.8 167.2 352 176 352L208 352C216.8 352 224 344.8 224 336L224 304C224 295.2 216.8 288 208 288L176 288C167.2 288 160 295.2 160 304zM288 304L288 336C288 344.8 295.2 352 304 352L336 352C344.8 352 352 344.8 352 336L352 304C352 295.2 344.8 288 336 288L304 288C295.2 288 288 295.2 288 304zM432 288C423.2 288 416 295.2 416 304L416 336C416 344.8 423.2 352 432 352L464 352C472.8 352 480 344.8 480 336L480 304C480 295.2 472.8 288 464 288L432 288zM160 432L160 464C160 472.8 167.2 480 176 480L208 480C216.8 480 224 472.8 224 464L224 432C224 423.2 216.8 416 208 416L176 416C167.2 416 160 423.2 160 432zM304 416C295.2 416 288 423.2 288 432L288 464C288 472.8 295.2 480 304 480L336 480C344.8 480 352 472.8 352 464L352 432C352 423.2 344.8 416 336 416L304 416zM416 432L416 464C416 472.8 423.2 480 432 480L464 480C472.8 480 480 472.8 480 464L480 432C480 423.2 472.8 416 464 416L432 416C423.2 416 416 423.2 416 432z"/>
                        </svg>
                        Información de la Clase
                    </h5>
                </div>
                <div class="p-6">
                    <form method="post" id="claseForm">
                        {% csrf_token %}
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Tipo de Clase -->
                            <div class="col-span-1 md:col-span-1">
                                <label for="tipo" class="flex flex-row items-center gap-1 text-md font-medium text-gris-oscuro mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 mb-0.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
                                    </svg>
                                    Tipo de Clase *
                                </label>
                                <select name="tipo" id="tipo" class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200 bg-white" required onchange="toggleEspecialFields()">
                                    <option value="">Selecciona un tipo</option>
                                    {% for value, label in tipos_clases %}
                                        <option value="{{ value }}" 
                                            {% if clase and clase.tipo == value %}selected{% endif %}
                                            {% if form_data.tipo == value %}selected{% endif %}>
                                            {{ label }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <div class="mt-2">
                                    <small class="text-gris-medio flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Selecciona "Clase Especial" para crear clases personalizadas
                                    </small>
                                </div>
                            </div>

                            <!-- Nombre Personalizado (solo para clases especiales) -->
                            <div class="col-span-1 md:col-span-1" id="nombre_personalizado_container" style="display: none;">
                                <label for="nombre_personalizado" class="flex flex-row items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 mb-0.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
                                    </svg>
                                    Nombre de la Clase Especial *
                                </label>
                                <input type="text" 
                                    name="nombre_personalizado" 
                                    id="nombre_personalizado" 
                                    class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200 bg-white"
                                    placeholder="Ej: Pilates Prenatal, Rehabilitación, etc."
                                    maxlength="100"
                                    value="{% if clase %}{{ clase.nombre_personalizado|default:'' }}{% endif %}{% if form_data.nombre_personalizado %}{{ form_data.nombre_personalizado }}{% endif %}">
                                <div class="mt-2">
                                    <small class="text-gris-medio flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Nombre descriptivo para la clase especial
                                    </small>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <!-- Día de la Semana -->
                            <div class="col-span-1 md:col-span-1">
                                <label for="dia" class="flex flex-row items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 mb-0.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z" />
                                    </svg>
                                    Día de la Semana *
                                </label>
                                <select name="dia" id="dia" class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200 bg-white" required>
                                    <option value="">Selecciona un día</option>
                                    {% for value, label in dias_semana %}
                                        <option value="{{ value }}" 
                                            data-especial-only="{% if value == 'Sábado' %}true{% else %}false{% endif %}"
                                            {% if clase and clase.dia == value %}selected{% endif %}
                                            {% if form_data.dia == value %}selected{% endif %}>
                                            {{ label }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <div class="mt-2">
                                    <small class="text-gris-medio flex items-center" id="dia_help_text">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Día de la semana para la clase recurrente
                                    </small>
                                </div>
                            </div>

                            <!-- Horario -->
                            <div class="col-span-1 md:col-span-1">
                                <label for="horario" class="flex flex-row items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 mb-0.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                    </svg>
                                    Horario *
                                </label>
                                <input type="time" 
                                    name="horario" 
                                    id="horario" 
                                    class="w-full px-4 py-2.5 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200 bg-white" 
                                    value="{% if clase %}{{ clase.horario|time:'H:i' }}{% endif %}{% if form_data.horario %}{{ form_data.horario }}{% endif %}"
                                    min="06:00" 
                                    max="22:00"
                                    required>
                                <div class="mt-2">
                                    <small class="text-gris-medio flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Horario entre 06:00 y 22:00 hrs
                                    </small>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <!-- Sede -->
                            <div class="col-span-1 md:col-span-1">
                                <label for="direccion" class="flex flex-row items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 mb-0.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                                    </svg>
                                    Sede *
                                </label>
                                <select name="direccion" id="direccion" class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200 bg-white" required>
                                    <option value="">Selecciona una sede</option>
                                    {% for value, label in direcciones %}
                                        <option value="{{ value }}" 
                                            {% if clase and clase.direccion == value %}selected{% endif %}
                                            {% if form_data.direccion == value %}selected{% endif %}>
                                            {{ label }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <div class="mt-2">
                                    <small class="text-gris-medio flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Selecciona la sede donde se dictará la clase
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Cupo Máximo -->
                            <div class="col-span-1 md:col-span-1">
                                <div class="col-span-1 md:col-span-1">
                                    <label for="cupo_maximo" class="flex flex-row items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                        Cupo Máximo *
                                    </label>
                                    <input type="number" 
                                        name="cupo_maximo" 
                                        id="cupo_maximo" 
                                        class="w-full px-4 py-2.5 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200 bg-white" 
                                        value="{% if clase %}{{ clase.cupo_maximo }}{% endif %}{% if form_data.cupo_maximo %}{{ form_data.cupo_maximo }}{% endif %}"
                                        min="1" 
                                        max="20" 
                                        required>
                                    <div class="mt-2">
                                        <small class="text-gris-medio flex items-center">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            Número máximo de personas por clase (1-20)
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <!-- Estado (solo para edición) -->
                            {% if clase %}
                            <div class="col-span-1 md:col-span-2 flex items-center">
                                <div class="flex items-center">
                                    <input class="h-4 w-4 text-principal focus:ring-principal border-gray-300 rounded" 
                                        type="checkbox" 
                                        name="activa" 
                                        id="activa" 
                                        {% if clase.activa %}checked{% endif %}>
                                    <label class="ml-3 text-sm font-medium text-gris-oscuro flex items-center" for="activa">
                                        <svg class="w-6 h-6 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                                        </svg>
                                        Clase Activa
                                    </label>
                                </div>
                                <div class="ml-6">
                                    <small class="text-gris-medio flex items-center">
                                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Las clases inactivas no aparecerán disponibles para reservar
                                    </small>
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Preview Section -->
                        <div class="grid grid-cols-1 gap-6 mt-6">
                            <div class="col-span-1">
                                <div class="card bg-fondo border border-gris-medio/20 rounded-lg">
                                    <div class="card-header bg-info text-white p-4 rounded-t-lg">
                                        <h6 class="text-lg font-semibold mb-0 flex items-center gap-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                                                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                                <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                            </svg>
                                            Vista Previa de la Clase
                                        </h6>
                                    </div>
                                    <div class="p-4">
                                        <div id="preview-content" class="text-center text-gris-medio">
                                            <svg class="w-5 h-5 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            Completa los campos para ver la vista previa
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Warning for existing class -->
                        {% if clase and not clase.puede_eliminarse %}
                        <div class="grid grid-cols-1 gap-6 mt-6">
                            <div class="col-span-1">
                                <div class="bg-advertencia/10 border border-advertencia/30 text-advertencia px-4 py-3 rounded-lg">
                                    <div class="flex items-center">
                                        <svg class="w-5 h-5 mr-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.732 18.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                        <div>
                                            <strong>Atención:</strong> Esta clase tiene {{ clase.reserva_set.filter.count|default:0 }} reservas activas. 
                                            Si cambias el horario o día, afectarás a todos los usuarios con reservas.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Action Buttons -->
                        <div class="grid grid-cols-1 gap-6 mt-8">
                            <div class="col-span-2">
                                <div class="flex gap-3 justify-center">
                                    <a href="{% url 'gravity:admin_clases_lista' %}" 
                                    class="inline-flex items-center gap-1 border border-gray-400 text-principal hover:text-fondo hover:bg-principal font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                        Cancelar
                                    </a>
                                    
                                    <button type="submit" 
                                            class="inline-flex items-center gap-1 btn-primary text-blanco" 
                                            id="submitBtn">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            {% if clase %}
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                                            {% else %}
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                            {% endif %}
                                        </svg>
                                        <span id="submitText">
                                            {% if clase %}Guardar Cambios{% else %}Crear Clase{% endif %}
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Information Sidebar -->
        <div class="lg:col-span-4">
            <!-- Tips Card -->
            <div class="card mb-6">
                <div class="card-header text-blanco p-4 rounded-t-lg">
                    <h6 class="text-lg mb-0 flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="size-6 mb-1">
                            <path d="M420.9 448C428.2 425.7 442.8 405.5 459.3 388.1C492 353.7 512 307.2 512 256C512 150 426 64 320 64C214 64 128 150 128 256C128 307.2 148 353.7 180.7 388.1C197.2 405.5 211.9 425.7 219.1 448L420.8 448zM416 496L224 496L224 512C224 556.2 259.8 592 304 592L336 592C380.2 592 416 556.2 416 512L416 496zM312 176C272.2 176 240 208.2 240 248C240 261.3 229.3 272 216 272C202.7 272 192 261.3 192 248C192 181.7 245.7 128 312 128C325.3 128 336 138.7 336 152C336 165.3 325.3 176 312 176z"/>
                        </svg>
                        Consejos
                    </h6>
                </div>
                <div class="p-4">
                    <ul class="space-y-3">
                        <li class="flex items-start">
                            <svg class="w-4 h-4 text-principal mr-1 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <small>Usa "Clase Especial" para clases personalizadas</small>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-4 h-4 text-principal mr-1 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <small>Solo las clases especiales pueden ser los sábados</small>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-4 h-4 text-principal mr-1 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <small>El cupo máximo depende del equipo disponible</small>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-4 h-4 text-principal mr-1 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <small>Los horarios deben estar en el rango laboral</small>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-4 h-4 text-principal mr-1 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <small>Las clases inactivas no son visibles para usuarios</small>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Clase Especial Info -->
            <div class="card mb-6" id="especial_info_card" style="display: none;">
                <div class="card-header text-blanco p-4 rounded-t-lg">
                    <h6 class="text-lg mb-0 flex items-center">
                        <svg class="w-6 h-6 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                        </svg>
                        Clases Especiales
                    </h6>
                </div>
                <div class="p-4">
                    <p class="text-gris-medio mb-3">
                        <small>Las clases especiales te permiten crear clases personalizadas:</small>
                    </p>
                    <ul class="space-y-2 mb-4">
                        <li class="flex items-start">
                            <svg class="w-4 h-4 text-secundario mr-1 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <small>Nombre personalizable</small>
                        </li>
                        <li class="flex items-start">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-secundario mr-1 mt-0.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" />
                            </svg>
                            <small>Disponibles también los sábados</small>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-4 h-4 text-secundario mr-1 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            <small>Ideales para talleres y eventos</small>
                        </li>
                    </ul>
                    
                    <hr class="border-gray-200 my-4">
                    
                    <div>
                        <strong class="text-sm">Ejemplos de nombres:</strong>
                        <div class="mt-2 flex flex-wrap gap-1">
                            <span class="inline-block bg-secundario/10 text-secundario text-xs px-2 py-1 rounded">Pilates Prenatal</span>
                            <span class="inline-block bg-secundario/10 text-secundario text-xs px-2 py-1 rounded">Rehabilitación</span>
                            <span class="inline-block bg-secundario/10 text-secundario text-xs px-2 py-1 rounded">Taller Intensivo</span>
                            <span class="inline-block bg-secundario/10 text-secundario text-xs px-2 py-1 rounded">Pilates Senior</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Información de Clases Actuales (solo al crear) -->
            {% if not clase %}
            <div class="card">
                <div class="card-header text-blanco p-4 rounded-t-lg">
                    <h6 class="text-lg mb-0 flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="size-6 mb-1">
                            <path d="M224 64C241.7 64 256 78.3 256 96L256 128L384 128L384 96C384 78.3 398.3 64 416 64C433.7 64 448 78.3 448 96L448 128L480 128C515.3 128 544 156.7 544 192L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 192C96 156.7 124.7 128 160 128L192 128L192 96C192 78.3 206.3 64 224 64zM160 304L160 336C160 344.8 167.2 352 176 352L208 352C216.8 352 224 344.8 224 336L224 304C224 295.2 216.8 288 208 288L176 288C167.2 288 160 295.2 160 304zM288 304L288 336C288 344.8 295.2 352 304 352L336 352C344.8 352 352 344.8 352 336L352 304C352 295.2 344.8 288 336 288L304 288C295.2 288 288 295.2 288 304zM432 288C423.2 288 416 295.2 416 304L416 336C416 344.8 423.2 352 432 352L464 352C472.8 352 480 344.8 480 336L480 304C480 295.2 472.8 288 464 288L432 288zM160 432L160 464C160 472.8 167.2 480 176 480L208 480C216.8 480 224 472.8 224 464L224 432C224 423.2 216.8 416 208 416L176 416C167.2 416 160 423.2 160 432zM304 416C295.2 416 288 423.2 288 432L288 464C288 472.8 295.2 480 304 480L336 480C344.8 480 352 472.8 352 464L352 432C352 423.2 344.8 416 336 416L304 416zM416 432L416 464C416 472.8 423.2 480 432 480L464 480C472.8 480 480 472.8 480 464L480 432C480 423.2 472.8 416 464 416L432 416C423.2 416 416 423.2 416 432z"/>
                        </svg>
                        Clases Existentes
                    </h6>
                </div>
                <div class="p-4">
                    <div class="text-gris-medio mb-3">
                        <small class="flex items-center">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Asegúrate de no crear duplicados
                        </small>
                    </div>
                    <div id="existing-classes">
                        <div class="text-center">
                            <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-principal"></div>
                            <br>
                            <small class="text-gris-medio">Cargando clases existentes...</small>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Información de la Clase Actual (solo para edición) -->
            {% if clase %}
            <div class="card">
                <div class="card-header text-blanco p-4 rounded-t-lg">
                    <h6 class="text-lg mb-0 flex items-center">
                        <svg class="w-6 h-6 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Información Actual
                    </h6>
                </div>
                <div class="p-4 space-y-3">
                    <div class="flex items-center justify-between">
                        <strong class="text-sm">Tipo:</strong>
                        {% if clase.tipo == 'Especial' %}
                            <span class="inline-block bg-secundario text-blanco text-xs px-2 py-1 rounded">{{ clase.get_nombre_display }}</span>
                        {% else %}
                            <span class="inline-block bg-info text-white text-xs px-2 py-1 rounded">{{ clase.get_tipo_display }}</span>
                        {% endif %}
                    </div>
                    <div class="flex items-center justify-between">
                        <strong class="text-sm">Reservas Activas:</strong>
                        <span class="inline-block bg-principal text-white text-xs px-2 py-1 rounded">{{ clase.reserva_set.filter.count|default:0 }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <strong class="text-sm">Cupos Disponibles:</strong>
                        <span class="inline-block bg-secundario text-white text-xs px-2 py-1 rounded">{{ clase.cupos_disponibles|default:0 }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <strong class="text-sm">Ocupación:</strong>
                        <span class="inline-block bg-principal text-white text-xs px-2 py-1 rounded">{{ clase.get_porcentaje_ocupacion|default:0 }}%</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <strong class="text-sm">Estado:</strong>
                        {% if clase.activa %}
                            <span class="inline-block bg-exito text-white text-xs px-2 py-1 rounded">Activa</span>
                        {% else %}
                            <span class="inline-block bg-error text-white text-xs px-2 py-1 rounded">Inactiva</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('claseForm');
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const previewContent = document.getElementById('preview-content');
            
            // Form fields
            const tipoSelect = document.getElementById('tipo');
            const nombrePersonalizadoInput = document.getElementById('nombre_personalizado');
            const diaSelect = document.getElementById('dia');
            const horarioInput = document.getElementById('horario');
            const cupoInput = document.getElementById('cupo_maximo');
            
            // Inicializa el estado del formulario
            toggleEspecialFields();
            updatePreview();
            
            // Actualiza la vista previa cuando los campos cambian
            function updatePreview() {
                const tipo = tipoSelect.value;
                const nombrePersonalizado = nombrePersonalizadoInput.value;
                const sede = document.getElementById('direccion').value;
                const dia = diaSelect.value;
                const horario = horarioInput.value;
                const cupo = cupoInput.value;
                
                if (tipo && sede && dia && horario && cupo) {
                    let tipoText;
                    let iconSvg;
                    
                    if (tipo === 'Especial' && nombrePersonalizado) {
                        tipoText = nombrePersonalizado;
                        iconSvg = '<img src="{% static "icons/especial.png" %}" alt="Icono de Clase Especial" class="size-12 mx-auto">';
                    } else if (tipo === 'Especial') {
                        tipoText = 'Clase Especial (sin nombre)';
                        iconSvg = '<img src="{% static "icons/especial.png" %}" alt="Icono de Clase Especial" class="size-12 mx-auto">';
                    } else {
                        const tipoOption = tipoSelect.options[tipoSelect.selectedIndex];
                        tipoText = tipoOption.text;
                        if (tipo === 'Reformer') {
                            iconSvg = '<img src="{% static "icons/reformer.png" %}" alt="Icono de Reformer" class="size-12 mx-auto">';
                        } else {
                            iconSvg = '<img src="{% static "icons/cadillac.png" %}" alt="Icono de Cadillac" class="size-12 mx-auto">';
                        }
                    }
                    
                    previewContent.innerHTML = 
                        '<div class="flex items-center justify-center">' +
                            '<div class="mr-4">' +
                                iconSvg +
                            '</div>' +
                            '<div class="text-left">' +
                                '<h6 class="text-lg font-semibold text-gris-oscuro mb-1">' + tipoText + '</h6>' +
                                '<small class="text-gris-medio">' +
                                    '<svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>' + document.getElementById('direccion').options[document.getElementById('direccion').selectedIndex].text + '<br>' +
                                    '<svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 0V7a2 2 0 012-2h4a2 2 0 012 2v0m-6 0h6"></path></svg>' + dia + ' - ' +
                                    '<svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' + horario + ' - ' +
                                    '<svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>' + cupo + ' cupos' +
                                '</small>' +
                            '</div>' +
                        '</div>';
                } else {
                    previewContent.innerHTML = '<svg class="w-5 h-5 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Completa los campos para ver la vista previa';
                }
            }
            
            // Agrega los event listeners
            [tipoSelect, nombrePersonalizadoInput, diaSelect, horarioInput, cupoInput].forEach(function(field) {
                field.addEventListener('change', updatePreview);
                field.addEventListener('input', updatePreview);
            });
            
            document.getElementById('direccion').addEventListener('change', updatePreview);
            
            // Validación y envío del formulario
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Mostrar estado de carga
                const originalText = submitText.textContent;
                submitText.textContent = 'Guardando...';
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-1"></div>' + submitText.textContent;
                
                // Validar formulario
                let isValid = true;
                const requiredFields = [tipoSelect, diaSelect, horarioInput, cupoInput];
                
                // Agrega nombre_personalizado a los requeridos si el tipo es 'Especial'
                if (tipoSelect.value === 'Especial') {
                    requiredFields.push(nombrePersonalizadoInput);
                }
                
                requiredFields.forEach(function(field) {
                    if (!field.value.trim()) {
                        field.classList.add('border-error');
                        field.classList.remove('border-gris-medio/30');
                        isValid = false;
                    } else {
                        field.classList.remove('border-error');
                        field.classList.add('border-gris-medio/30');
                    }
                });
                
                // Validar que el sábado solo sea para clases especiales
                if (diaSelect.value === 'Sábado' && tipoSelect.value !== 'Especial') {
                    diaSelect.classList.add('border-error');
                    diaSelect.classList.remove('border-gris-medio/30');
                    isValid = false;
                    alert('Solo las clases especiales pueden programarse los sábados.');
                }
                
                // Validar rango de horario
                if (horarioInput.value) {
                    const time = horarioInput.value;
                    const timeParts = time.split(':');
                    const hours = parseInt(timeParts[0]);
                    const minutes = parseInt(timeParts[1]);
                    const totalMinutes = hours * 60 + minutes;
                    
                    if (totalMinutes < 6 * 60 || totalMinutes > 22 * 60) {
                        horarioInput.classList.add('border-error');
                        horarioInput.classList.remove('border-gris-medio/30');
                        isValid = false;
                        alert('El horario debe estar entre las 06:00 y las 22:00');
                    }
                }
                
                // Validar rango de cupo máximo
                if (cupoInput.value) {
                    const cupo = parseInt(cupoInput.value);
                    if (cupo < 1 || cupo > 20) {
                        cupoInput.classList.add('border-error');
                        cupoInput.classList.remove('border-gris-medio/30');
                        isValid = false;
                        alert('El cupo máximo debe estar entre 1 y 20');
                    }
                }
                
                if (isValid) {
                    // Submit form
                    this.submit();
                } else {
                    // Restablecer el estado del botón
                    submitText.textContent = originalText;
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>' + submitText.textContent;
                }
            });
            
            // Cargar clases existentes en modo creación
            const existingClassesDiv = document.getElementById('existing-classes');
            if (existingClassesDiv) {
                fetch('/api/clases-disponibles/')
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(data) {
                        if (data.length > 0) {
                            let html = '<div class="text-sm space-y-2">';
                            data.forEach(function(clase) {
                                html += 
                                    '<div class="flex justify-between items-center p-2 bg-fondo/50 rounded-lg">' +
                                        '<div>' +
                                            '<strong class="text-sm">' + clase.tipo_display + '</strong><br>' +
                                            '<small class="text-gris-medio">' + clase.dia + ' ' + clase.horario_display + '</small>' +
                                        '</div>' +
                                        '<small class="inline-block bg-secundario text-white text-xs px-2 py-1 rounded">' + clase.cupos_disponibles + '/' + clase.cupo_maximo + '</small>' +
                                    '</div>';
                            });
                            html += '</div>';
                            existingClassesDiv.innerHTML = html;
                        } else {
                            existingClassesDiv.innerHTML = '<small class="text-gris-medio">No hay clases creadas aún</small>';
                        }
                    })
                    .catch(function(error) {
                        existingClassesDiv.innerHTML = '<small class="text-error">Error al cargar clases</small>';
                    });
            }
        });

        // Función para mostrar/ocultar campos de clase especial
        function toggleEspecialFields() {
            const tipoSelect = document.getElementById('tipo');
            const nombreContainer = document.getElementById('nombre_personalizado_container');
            const nombreInput = document.getElementById('nombre_personalizado');
            const diaSelect = document.getElementById('dia');
            const diaHelpText = document.getElementById('dia_help_text');
            const especialInfoCard = document.getElementById('especial_info_card');
            
            const isEspecial = tipoSelect.value === 'Especial';
            
            // Mostrar/ocultar campo de nombre personalizado
            if (isEspecial) {
                nombreContainer.style.display = 'block';
                nombreInput.required = true;
                especialInfoCard.style.display = 'block';
            } else {
                nombreContainer.style.display = 'none';
                nombreInput.required = false;
                nombreInput.value = '';
                especialInfoCard.style.display = 'none';
            }
            
            // Actualiza las opciones del campo día y el texto de ayuda
            const diaOptions = diaSelect.querySelectorAll('option[data-especial-only="true"]');
            diaOptions.forEach(function(option) {
                if (isEspecial) {
                    option.style.display = 'block';
                    option.disabled = false;
                } else {
                    if (option.selected) {
                        // Restablece la selección al valor predeterminado
                        diaSelect.selectedIndex = 0;
                    }
                    option.style.display = 'none';
                    option.disabled = true;
                }
            });
            
            // Actualiza el texto de ayuda
            if (isEspecial) {
                diaHelpText.innerHTML = '<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Las clases especiales pueden programarse cualquier día, incluidos sábados';
            } else {
                diaHelpText.innerHTML = '<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Día de la semana para la clase recurrente (Lunes a Viernes)';
            }
        }
    </script>
{% endblock %}