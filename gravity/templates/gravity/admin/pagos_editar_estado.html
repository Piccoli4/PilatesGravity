{% extends "gravity/admin/base_admin.html" %}

{% block title %}Editar Estado de Pago{% endblock %}

{% block breadcrumb %}
    <li class="flex items-center gap-1">
        <span class="text-gris-medio">/</span>
        <span class="text-gris-medio">Pagos</span>
    </li>
    <li class="flex items-center">
        <span class="text-gris-medio">/</span>
        <span class="ml-1 text-gris-medio">Editar estado de {{ cliente.get_full_name|default:cliente.username }}</span>
    </li>
{% endblock %}

{% block content %}
    <!-- Header Section -->
    <div class="card p-3 flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6">
        <div>
            <div class="flex items-center gap-2 mb-2 text-principal">
                <svg class="size-10" fill="currentColor" viewBox="0 0 640 640" xmlns="http://www.w3.org/2000/svg">
                    <path d="M128.1 64C92.8 64 64.1 92.7 64.1 128L64.1 512C64.1 547.3 92.8 576 128.1 576L274.3 576L285.2 521.5C289.5 499.8 300.2 479.9 315.8 464.3L448 332.1L448 234.6C448 217.6 441.3 201.3 429.3 189.3L322.8 82.7C310.8 70.7 294.5 64 277.6 64L128.1 64zM389.6 240L296.1 240C282.8 240 272.1 229.3 272.1 216L272.1 122.5L389.6 240zM332.3 530.9L320.4 590.5C320.2 591.4 320.1 592.4 320.1 593.4C320.1 601.4 326.6 608 334.7 608C335.7 608 336.6 607.9 337.6 607.7L397.2 595.8C409.6 593.3 421 587.2 429.9 578.3L548.8 459.4L468.8 379.4L349.9 498.3C341 507.2 334.9 518.6 332.4 531zM600.1 407.9C622.2 385.8 622.2 350 600.1 327.9C578 305.8 542.2 305.8 520.1 327.9L491.3 356.7L571.3 436.7L600.1 407.9z"/>
                </svg>
                <h1 class="text-2xl lg:text-3xl font-bold">Editar Estado de Pago</h1>
            </div>
            <p class="text-gris-medio">
                Cliente: <strong class="text-principal">{{ cliente.get_full_name|default:cliente.username }}</strong>
            </p>
        </div>
        <a href="{% url 'gravity:admin_pagos_vista_principal' %}" 
           class="inline-flex items-center gap-2 px-4 py-2 bg-fondo border border-principal text-principal rounded-lg hover:bg-principal hover:text-fondo transition-all duration-200 shadow-sm hover:shadow-md">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Volver a Pagos
        </a>
    </div>

    <div class="card rounded-xl shadow-sm border border-gris-claro overflow-hidden">
        <!-- Header de la card -->
        <div class="card-header text-blanco flex items-center gap-2">
            <svg class="size-6" fill="currentColor" viewBox="0 0 640 640" xmlns="http://www.w3.org/2000/svg">
                <path d="M432.5 82.3L382.4 132.4L507.7 257.7L557.8 207.6C579.7 185.7 579.7 150.3 557.8 128.4L511.7 82.3C489.8 60.4 454.4 60.4 432.5 82.3zM343.3 161.2L342.8 161.3L198.7 204.5C178.8 210.5 163 225.7 156.4 245.5L67.8 509.8C64.9 518.5 65.9 528 70.3 535.8L225.7 380.4C224.6 376.4 224.1 372.3 224.1 368C224.1 341.5 245.6 320 272.1 320C298.6 320 320.1 341.5 320.1 368C320.1 394.5 298.6 416 272.1 416C267.8 416 263.6 415.4 259.7 414.4L104.3 569.7C112.1 574.1 121.5 575.1 130.3 572.2L394.6 483.6C414.3 477 429.6 461.2 435.6 441.3L478.8 297.2L478.9 296.7L343.4 161.2z"/>
            </svg>
            <h5 class="text-lg mb-0">Configuración Manual del Estado</h5>
        </div>
        
        <!-- Body de la card -->
        <div class="card-body p-3">
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Plan Actual -->
                    <div class="space-y-2">
                        <label for="{{ form.plan_actual.id_for_label }}" class="block text-sm font-medium text-gris-oscuro">
                            {{ form.plan_actual.label }}
                        </label>
                        <div class="relative">
                            <select name="{{ form.plan_actual.name }}" id="{{ form.plan_actual.id_for_label }}" 
                                    class="w-full px-3 py-2 border border-gris-claro rounded-lg focus:ring-2 focus:ring-principal focus:border-principal transition-colors">
                                {% for value, label in form.plan_actual.field.choices %}
                                    <option value="{{ value }}" {% if form.plan_actual.value == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% if form.plan_actual.errors %}
                            <div class="flex items-center gap-2 text-error text-sm">
                                <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                {{ form.plan_actual.errors.0 }}
                            </div>
                        {% endif %}
                        {% if form.plan_actual.help_text %}
                            <p class="text-sm text-gris-medio">{{ form.plan_actual.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Saldo Actual -->
                    <div class="space-y-2">
                        <label for="{{ form.saldo_actual.id_for_label }}" class="block text-sm font-medium text-gris-oscuro">
                            {{ form.saldo_actual.label }}
                        </label>
                        <div class="relative">
                            <input type="number" name="{{ form.saldo_actual.name }}" id="{{ form.saldo_actual.id_for_label }}" 
                                   value="{{ form.saldo_actual.value|default:'' }}" step="0.01"
                                   class="w-full px-3 py-2 pl-6 border border-gris-claro rounded-lg focus:ring-2 focus:ring-principal focus:border-principal transition-colors"
                                   placeholder="0,00">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gris-medio text-sm">$</span>
                            </div>
                        </div>
                        {% if form.saldo_actual.errors %}
                            <div class="flex items-center gap-2 text-error text-sm">
                                <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                {{ form.saldo_actual.errors.0 }}
                            </div>
                        {% endif %}
                        {% if form.saldo_actual.help_text %}
                            <p class="text-sm text-gris-medio">{{ form.saldo_actual.help_text }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Observaciones -->
                <div class="space-y-2">
                    <label for="{{ form.observaciones.id_for_label }}" class="block text-sm font-medium text-gris-oscuro">
                        {{ form.observaciones.label }}
                    </label>
                    <textarea name="{{ form.observaciones.name }}" id="{{ form.observaciones.id_for_label }}" 
                              class="w-full px-3 py-2 border border-gris-claro rounded-lg focus:ring-2 focus:ring-principal focus:border-principal transition-colors resize-y min-h-[100px]"
                              placeholder="Observaciones adicionales...">{{ form.observaciones.value|default:'' }}</textarea>
                    {% if form.observaciones.errors %}
                        <div class="flex items-center gap-2 text-error text-sm">
                            <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                            {{ form.observaciones.errors.0 }}
                        </div>
                    {% endif %}
                    {% if form.observaciones.help_text %}
                        <p class="text-sm text-gris-medio">{{ form.observaciones.help_text }}</p>
                    {% endif %}
                </div>
                
                <!-- Checkbox Activo -->
                <div class="bg-fondo rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <div class="flex items-center h-5">
                            <input type="checkbox" name="{{ form.activo.name }}" id="{{ form.activo.id_for_label }}" 
                                   {% if form.activo.value %}checked{% endif %}
                                   class="w-4 h-4 text-principal bg-white border-gris-claro rounded focus:ring-principal focus:ring-2">
                        </div>
                        <div class="flex-1">
                            <label for="{{ form.activo.id_for_label }}" class="text-sm font-medium text-gris-oscuro cursor-pointer">
                                {{ form.activo.label }}
                            </label>
                            {% if form.activo.help_text %}
                                <p class="text-sm text-gris-medio mt-1">{{ form.activo.help_text }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Botones de acción -->
                <div class="flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t border-gris-claro">
                    <a href="{% url 'gravity:admin_pagos_vista_principal' %}" 
                       class="inline-flex items-center justify-center px-4 py-2 bg-white border border-gris-claro text-gris-oscuro rounded-lg hover:bg-gris-claro hover:border-gris-medio transition-all duration-200 shadow-sm hover:shadow-md">
                        Cancelar
                    </a>
                    <button type="submit" 
                            class="inline-flex items-center justify-center gap-2 px-6 py-2 bg-principal text-white rounded-lg hover:bg-principal-dark transition-all duration-200 shadow-sm hover:shadow-md transform hover:scale-105">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <!-- Script para mejorar la UX -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Añadir animación de focus a los inputs
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('ring-2', 'ring-principal', 'ring-opacity-20');
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.classList.remove('ring-2', 'ring-principal', 'ring-opacity-20');
                });
            });

            // Animación para el botón de submit
            const submitBtn = document.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.addEventListener('click', function() {
                    this.classList.add('animate-pulse');
                    setTimeout(() => {
                        this.classList.remove('animate-pulse');
                    }, 2000);
                });
            }

            // Validación en tiempo real para el saldo
            const saldoInput = document.querySelector('#{{ form.saldo_actual.id_for_label }}');
            if (saldoInput) {
                saldoInput.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    if (isNaN(value) || value < 0) {
                        this.classList.add('border-error', 'focus:ring-error');
                        this.classList.remove('border-gris-claro', 'focus:ring-principal');
                    } else {
                        this.classList.remove('border-error', 'focus:ring-error');
                        this.classList.add('border-gris-claro', 'focus:ring-principal');
                    }
                });
            }
        });
    </script>
{% endblock %}