{% extends 'gravity/admin/base_admin.html' %}

{% block title %}Cancelar Reserva - Panel de Administración{% endblock %}

{% block breadcrumb %}
    <li class="flex items-center">
        <span class="text-gray-400">/</span>
        <a href="{% url 'gravity:admin_reservas_lista' %}" class="ml-1 text-principal hover:text-principal/80 transition-colors duration-200">
            Reservas
        </a>
    </li>
    <li class="flex items-center">
        <span class="text-gray-400">/</span>
        <span class="ml-1 text-gray-500">Cancelar</span>
    </li>
{% endblock %}

{% block content %}
    {% load static %}
    <!-- Header Section -->
    <div class="flex flex-col mb-6">
        <div class="w-full">
            <div class="card border-l-4 border-yellow-400 p-3">
                <div class="card-body">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div class="mb-4 md:mb-0">
                            <h2 class="flex items-center gap-2 text-2xl font-bold text-advertencia mb-2">
                                <svg class="size-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                Cancelar Reserva
                            </h2>
                            <p class="text-gris-medio mb-0">
                                Cancela la reserva del usuario.
                                <br> 
                                Esta acción notificará al cliente si marcas las opciones adicionales.
                            </p>
                        </div>
                        <div class="text-right">
                            <a 
                                href="{% url 'gravity:admin_reservas_lista' %}" 
                                class="flex items-center gap-1 border border-principal text-principal hover:bg-principal hover:text-fondo font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50"
                            >
                                <svg class="inline-block w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                                </svg>
                                Volver a Reservas
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex flex-col lg:flex-row gap-6">
        <div class="w-full lg:w-2/3">
            <!-- Información de la reserva -->
            <div class="card mb-6">
                <div class="card-header text-blanco">
                    <h5 class="flex items-center gap-1 text-lg">
                        <svg class="size-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/>
                        </svg>
                        Información de la Reserva
                    </h5>
                </div>
                <div class="card-body p-6 bg-fondo">
                    <div class="flex flex-col md:flex-row gap-6">
                        <div class="w-full md:w-1/2">
                            <!-- Información del Usuario -->
                            <div class="text-center mb-6">
                                <div class="user-avatar mx-auto mb-3" style="width: 80px; height: 80px; font-size: 2rem;">
                                    {% if reserva.usuario.profile.avatar %}
                                        <img src="{{ reserva.usuario.profile.avatar.url }}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                                    {% else %}
                                        {{ reserva.usuario.first_name.0|default:reserva.usuario.username.0|upper }}{{ reserva.usuario.last_name.0|upper|default:'' }}
                                    {% endif %}
                                </div>
                                <h4 class="text-xl font-semibold mb-1">{{ reserva.get_nombre_completo_usuario }}</h4>
                                <p class="text-gris-medio mb-2">@{{ reserva.usuario.username }}</p>
                                <span class="px-3 py-1.5 text-sm font-medium text-white bg-green-600 rounded-md">Usuario Activo</span>
                            </div>
                            
                            <div class="mb-4">
                                <h6 class="text-base font-semibold mb-3">Información de Contacto:</h6>
                                <ul class="space-y-2">
                                    <li class="flex items-center gap-1">
                                        <svg class="size-5 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                        </svg>
                                        <strong>Email:</strong>
                                        <a href="mailto:{{ reserva.usuario.email }}" class="hover:text-principal">{{ reserva.usuario.email }}</a>
                                    </li>
                                    {% if reserva.usuario.profile.telefono %}
                                        <li class="flex items-center gap-1">
                                            <svg class="size-5 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                            </svg>
                                            <strong>Teléfono:</strong>
                                            <a href="tel:{{ reserva.usuario.profile.telefono }}">{{ reserva.usuario.profile.telefono }}</a>
                                        </li>
                                    {% endif %}
                                    <li class="flex items-center gap-1">
                                        <svg class="size-5 text-principal mb-0.5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                        </svg>
                                        <strong>Miembro desde:</strong> {{ reserva.usuario.date_joined|date:"d/m/Y" }}
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="w-full md:w-1/2">
                            <!-- Información de la clase -->
                            <div class="flex flex-col items-center justify-center gap-2 mb-2">
                                {% if reserva.clase.tipo == 'Reformer' %}
                                    <img src="{% static 'icons/reformer.png' %}" alt="Icono de Reformer" class="size-16">
                                {% elif reserva.clase.tipo == 'Cadillac' %}
                                    <img src="{% static 'icons/cadillac.png' %}" alt="Icono de Cadillac" class="size-16">
                                {% else %}
                                    <img src="{% static 'icons/especial.png' %}" alt="Icono de Clase Especial" class="size-16">
                                {% endif %}
                                <h4 class="text-xl font-semibold mb-1">{{ reserva.clase.get_nombre_display }}</h4>
                                <p class="text-gris-medio mb-1">
                                    {{ reserva.clase.dia }} a las {{ reserva.clase.horario|time:"H:i" }}
                                </p>
                                <p class="text-principal flex items-center gap-1">
                                    <svg class="size-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                    </svg>
                                    <strong>{{ reserva.clase.get_direccion_corta }}</strong>
                                </p>
                                {% if reserva.clase.activa %}
                                    <span class="px-3 py-1.5 text-sm font-medium text-blanco bg-green-600 rounded-md">Clase Activa</span>
                                {% else %}
                                    <span class="px-3 py-1.5 text-sm font-medium text-blanco bg-red-600 rounded-md">Clase Inactiva</span>
                                {% endif %}
                            </div>
                            
                            <div class="mb-2">
                                <h6 class="text-base font-semibold mb-3">Detalles de la Clase:</h6>
                                <ul class="space-y-3">
                                    <li class="flex items-center gap-1">
                                        <svg class="size-4 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                        </svg>
                                        <strong>Sede:</strong> {{ reserva.clase.get_direccion_display }}
                                    </li>
                                    <li class="flex items-center gap-1">
                                        <svg class="size-4 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                        </svg>
                                        <strong>Día:</strong> {{ reserva.clase.dia }}
                                    </li>
                                    <li class="flex items-center gap-1">
                                        <svg class="size-4 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                        </svg>
                                        <strong>Horario:</strong> {{ reserva.clase.horario|time:"H:i" }}
                                    </li>
                                    <li class="flex items-center gap-1">
                                        <svg class="size-4 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                                        </svg>
                                        <strong>Cupo:</strong> {{ reserva.clase.cupo_maximo }} personas
                                    </li>
                                    <li class="flex items-center gap-1">
                                        <svg class="size-4 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/>
                                            <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"/>
                                        </svg>
                                        <strong>Ocupación:</strong> {{ reserva.clase.get_porcentaje_ocupacion }}%
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalles de la Reserva -->
                    <hr class="my-2 border-gris-claro">
                    <div class="w-full">
                        <h6 class="text-base font-semibold mb-4">Detalles de la Reserva:</h6>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="flex flex-col items-center gap-2">
                                <svg class="size-8 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                </svg>
                                <h6 class="font-semibold">{{ reserva.numero_reserva }}</h6>
                                <small class="text-gris-medio">Número de Reserva</small>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <svg class="size-8 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                </svg>
                                <h6 class="font-semibold">{{ reserva.fecha_reserva|date:"d/m/Y" }}</h6>
                                <small class="text-gris-medio">Fecha de Reserva</small>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <svg class="size-8 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                                <h6 class="font-semibold">{{ reserva.fecha_reserva|date:"H:i" }}</h6>
                                <small class="text-gris-medio">Hora de Reserva</small>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <svg class="size-8 text-principal" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                </svg>
                                <h6 class="font-semibold">{{ reserva.clase.get_direccion_corta }}</h6>
                                <small class="text-gris-medio">Sede de la Clase</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Próxima clase info -->
                    <div class="bg-principal border-l-4 border-secundario p-4 mt-6">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                            <div class="flex items-center gap-2 text-fondo">
                                <svg class="size-5 text-fondo" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                </svg>
                                <strong class="text-fondo">Próxima Clase:</strong> {{ reserva.get_proxima_clase_info }}
                            </div>
                            <small class="text-fondo">Reserva recurrente semanal</small>
                        </div>
                    </div>
                    
                    {% if reserva.notas %}
                        <div class="bg-blue-100 border border-blue-300 text-blue-800 p-4 mt-4 rounded">
                            <svg class="inline-block w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"/>
                                <path fill-rule="evenodd" d="M3 8a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                            </svg>
                            <strong>Notas:</strong> {{ reserva.notas }}
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Form cancelar clase -->
            <div class="card mb-6">
                <div class="card-header bg-warning text-blanco">
                    <h5 class="text-lg font-semibold flex items-center gap-2">
                        <svg class="size-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                        </svg>
                        Motivo de Cancelación
                    </h5>
                </div>
                <div class="card-body p-3">
                    <form method="post" id="cancelForm">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="motivo" class="flex items-center gap-1 mb-1 text-sm font-medium text-gray-700">
                                <svg class="size-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                                </svg>
                                Motivo de la cancelación *
                            </label>
                            <select name="motivo" id="motivo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-principal mb-3" required>
                                <option value="">Selecciona un motivo</option>
                                <option value="Solicitud del cliente">Solicitud del cliente</option>
                                <option value="Problema médico del cliente">Problema médico del cliente</option>
                                <option value="Cambio de horario de clase">Cambio de horario de clase</option>
                                <option value="Clase cancelada por el estudio">Clase cancelada por el estudio</option>
                                <option value="Cambio de sede">Cambio de sede</option>
                                <option value="Problemas de acceso a la sede">Problemas de acceso a la sede</option>
                                <option value="Falta de pago">Falta de pago</option>
                                <option value="Incumplimiento de normas">Incumplimiento de normas</option>
                                <option value="Error administrativo">Error administrativo</option>
                                <option value="Otro">Otro motivo</option>
                            </select>
                            
                            <textarea name="motivo_detalle" 
                                    id="motivo_detalle" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-principal" 
                                    rows="4" 
                                    placeholder="Describe el motivo de la cancelación con más detalle (opcional)..."></textarea>
                            <div class="mt-1">
                                <small class="flex items-center gap-1 text-gris-medio">
                                    <svg class="size-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    Esta información se guardará para referencia futura y ayudará a mejorar el servicio.
                                </small>
                            </div>
                        </div>
                        
                        <!-- Opciones -->
                        <div class="mb-6">
                            <h6 class="text-base font-semibold mb-4">Opciones adicionales:</h6>
                            
                            <div class="space-y-3">
                                <div class="flex items-center">
                                    <input class="w-4 h-4 text-principal bg-gray-100 border-gray-300 rounded focus:ring-principal focus:ring-2" 
                                        type="checkbox" 
                                        name="notificar_usuario" 
                                        id="notificar_usuario" 
                                        checked>
                                    <label class="ml-2 text-sm text-gray-700" for="notificar_usuario">
                                        <svg class="inline-block w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                        </svg>
                                        Notificar al usuario por email sobre la cancelación
                                    </label>
                                </div>
                                
                                <div class="flex items-center">
                                    <input class="w-4 h-4 text-principal bg-gray-100 border-gray-300 rounded focus:ring-principal focus:ring-2" 
                                        type="checkbox" 
                                        name="ofrecer_reemplazo" 
                                        id="ofrecer_reemplazo">
                                    <label class="ml-2 text-sm text-gray-700" for="ofrecer_reemplazo">
                                        <svg class="inline-block w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                        </svg>
                                        Sugerir clases alternativas (misma sede) en el email
                                    </label>
                                </div>
                                
                                <div class="flex items-center">
                                    <input class="w-4 h-4 text-principal bg-gray-100 border-gray-300 rounded focus:ring-principal focus:ring-2" 
                                        type="checkbox" 
                                        name="ofrecer_otras_sedes" 
                                        id="ofrecer_otras_sedes">
                                    <label class="ml-2 text-sm text-gray-700" for="ofrecer_otras_sedes">
                                        <svg class="inline-block w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                        </svg>
                                        Incluir opciones de otras sedes en las sugerencias
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Warning -->
                        <div class="bg-advertencia/30 border-l-4 border-advertencia text-yellow-800 p-4 mb-6 rounded">
                            <div class="flex items-center gap-1">
                                <svg class="size-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                <strong>Atención:</strong> Al cancelar esta reserva:
                            </div>
                            <ul class="mt-2 ml-6 list-disc space-y-1">
                                <li>El usuario perderá su lugar en la clase de <strong>{{ reserva.clase.get_direccion_corta }}</strong></li>
                                <li>Se liberará un cupo para otros usuarios en esa sede</li>
                                <li>La reserva no se puede recuperar una vez cancelada</li>
                                <li>Se registrará la cancelación en el historial del usuario</li>
                            </ul>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-3 justify-center">
                            <a href="{% url 'gravity:admin_reservas_lista' %}" 
                            class="flex items-center gap-1 border border-gray-400 text-gray-700 hover:bg-gray-50 font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50">
                                <svg class="size-4 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                                Me Arrepenti
                            </a>
                            
                            <button type="submit" 
                                    class="flex items-center gap-1 bg-red-600 text-white hover:bg-red-700 font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50" 
                                    id="confirmCancelBtn">
                                <svg class="size-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"/>
                                </svg>
                                <span id="cancelText">Cancelar Reserva</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Information Sidebar -->
        <div class="w-full lg:w-1/3">
            <!-- User Statistics -->
            <div class="card mb-6">
                <div class="card-header bg-principal text-blanco">
                    <h6 class="flex items-center gap-2 mb-0">
                        <svg class="size-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                        Estadísticas del Usuario
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="text-center mb-4">
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <div class="text-2xl font-bold text-principal">{{ reserva.usuario.reservas_pilates.count|default:0 }}</div>
                                <small class="text-gris-medio">Total Reservas</small>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-green-500">{{ reserva.usuario.reservas_pilates.filter.count|default:0 }}</div>
                                <small class="text-gris-medio">Activas</small>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4 border-gris-claro">
                    
                    <div class="mb-4">
                        <strong>Experiencia:</strong>
                        {% if reserva.usuario.profile.nivel_experiencia %}
                            <span class="inline-block px-2 py-1 text-xs font-medium text-white bg-blue-400 rounded-md ml-2">{{ reserva.usuario.profile.get_nivel_experiencia_display }}</span>
                        {% else %}
                            <span class="text-gris-medio ml-2">No especificado</span>
                        {% endif %}
                    </div>
                    
                    <div class="mb-4">
                        <strong>Sede preferida:</strong>
                        <div class="mt-1">
                            <span class="inline-block px-2 py-1 text-xs font-medium text-white bg-gris-medio rounded-md">{{ reserva.clase.get_direccion_corta }}</span>
                        </div>
                        <small class="text-gris-medio">Basado en esta reserva</small>
                    </div>
                    
                    {% if reserva.usuario.profile.tiene_lesiones %}
                        <div class="flex items-center gap-1 bg-advertencia/20 border border-yellow-800 text-yellow-800 p-2 rounded">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="size-5" fill="currentColor">
                                <path d="M160 416C160 451.3 188.7 480 224 480L405.5 480C422.5 480 438.8 473.3 450.8 461.3L557.3 354.7C569.3 342.7 576 326.4 576 309.4L576 128C576 92.7 547.3 64 512 64L224 64C188.7 64 160 92.7 160 128L160 416zM352 176L384 176C392.8 176 400 183.2 400 192L400 240L448 240C456.8 240 464 247.2 464 256L464 288C464 296.8 456.8 304 448 304L400 304L400 352C400 360.8 392.8 368 384 368L352 368C343.2 368 336 360.8 336 352L336 304L288 304C279.2 304 272 296.8 272 288L272 256C272 247.2 279.2 240 288 240L336 240L336 192C336 183.2 343.2 176 352 176zM112 184C112 170.7 101.3 160 88 160C74.7 160 64 170.7 64 184L64 512C64 547.3 92.7 576 128 576L392 576C405.3 576 416 565.3 416 552C416 538.7 405.3 528 392 528L128 528C119.2 528 112 520.8 112 512L112 184z"/>
                            </svg>
                            <small><strong>Tiene lesiones o condiciones médicas</strong></small>
                        </div>
                    {% endif %}
                    
                    <div class="mt-4">
                        <a 
                            href="{% url 'gravity:admin_usuario_detalle' reserva.usuario.id %}" 
                            class="w-full flex items-center justify-center gap-1 border border-principal/90 text-principal hover:bg-principal hover:text-fondo font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                        >
                            <svg class="size-5 mb-0.5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                            Ver Perfil Completo
                        </a>
                    </div>
                </div>
            </div>

            <!-- Información de la clase -->
            <div class="card mb-6">
                <div class="card-header bg-info text-blanco">
                    <h6 class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="size-5">
                            <path d="M320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM288 224C288 206.3 302.3 192 320 192C337.7 192 352 206.3 352 224C352 241.7 337.7 256 320 256C302.3 256 288 241.7 288 224zM280 288L328 288C341.3 288 352 298.7 352 312L352 400L360 400C373.3 400 384 410.7 384 424C384 437.3 373.3 448 360 448L280 448C266.7 448 256 437.3 256 424C256 410.7 266.7 400 280 400L304 400L304 336L280 336C266.7 336 256 325.3 256 312C256 298.7 266.7 288 280 288z"/>
                        </svg>
                        Información de la Clase
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="text-center mb-4">
                        <h5 class="text-lg font-semibold mb-1">{{ reserva.clase.get_nombre_display }}</h5>
                        <p class="text-gris-medio mb-2">
                            {{ reserva.clase.dia }} - {{ reserva.clase.horario|time:"H:i" }}
                        </p>
                        <div class="inline-block px-2 py-1 text-sm font-medium text-fondo bg-principal rounded-md">{{ reserva.clase.get_direccion_corta }}</div>
                    </div>
                    
                    <hr class="my-3 border-principal/30">
                    
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="text-2xl font-bold text-green-500">{{ reserva.clase.cupos_disponibles }}</div>
                            <small class="text-gris-medio">Libres</small>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-advertencia">{{ reserva.clase.get_reservas_activas.count }}</div>
                            <small class="text-gris-medio">Ocupados</small>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-principal">{{ reserva.clase.cupo_maximo }}</div>
                            <small class="text-gris-medio">Total</small>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{% url 'gravity:admin_clase_detalle' reserva.clase.id %}" 
                        class="w-full flex items-center gap-1 w-full flex items-center justify-center gap-1 border border-principal/90 text-principal hover:bg-principal hover:text-fondo font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                            <svg class="inline-block w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                            </svg>
                            Ver Clase Completa
                        </a>
                    </div>
                </div>
            </div>

            <!-- Acciones Alternativas -->
            <div class="card mb-6">
                <div class="card-header text-blanco">
                    <h6 class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="size-5">
                            <path d="M102.8 57.3C108.2 51.9 116.6 51.1 123 55.3L241.9 134.5C250.8 140.4 256.1 150.4 256.1 161.1L256.1 210.7L346.9 301.5C380.2 286.5 420.8 292.6 448.1 320L574.2 446.1C592.9 464.8 592.9 495.2 574.2 514L514.1 574.1C495.4 592.8 465 592.8 446.2 574.1L320.1 448C292.7 420.6 286.6 380.1 301.6 346.8L210.8 256L161.2 256C150.5 256 140.5 250.7 134.6 241.8L55.4 122.9C51.2 116.6 52 108.1 57.4 102.7L102.8 57.3zM247.8 360.8C241.5 397.7 250.1 436.7 274 468L179.1 563C151 591.1 105.4 591.1 77.3 563C49.2 534.9 49.2 489.3 77.3 461.2L212.7 325.7L247.9 360.8zM416.1 64C436.2 64 455.5 67.7 473.2 74.5C483.2 78.3 485 91 477.5 98.6L420.8 155.3C417.8 158.3 416.1 162.4 416.1 166.6L416.1 208C416.1 216.8 423.3 224 432.1 224L473.5 224C477.7 224 481.8 222.3 484.8 219.3L541.5 162.6C549.1 155.1 561.8 156.9 565.6 166.9C572.4 184.6 576.1 203.9 576.1 224C576.1 267.2 558.9 306.3 531.1 335.1L482 286C448.9 253 403.5 240.3 360.9 247.6L304.1 190.8L304.1 161.1L303.9 156.1C303.1 143.7 299.5 131.8 293.4 121.2C322.8 86.2 366.8 64 416.1 63.9z"/>
                        </svg>
                        Acciones Alternativas
                    </h6>
                </div>
                <div class="card-body p-3">
                    <p class="text-gris-medio mb-4">
                        <small>¿Buscas hacer algo diferente a cancelar?</small>
                    </p>
                    
                    <div class="space-y-2">
                        <a href="{% url 'gravity:admin_reservas_lista' %}?usuario={{ reserva.usuario.username }}" 
                        class="w-full flex items-center justify-center gap-1 border border-blue-500 text-blue-600 hover:bg-blue-500 hover:text-white font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                            <svg class="size-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/>
                            </svg>
                            Otras Reservas del Usuario
                        </a>
                        
                        <a href="{% url 'gravity:admin_reservas_lista' %}?sede={{ reserva.clase.direccion }}" 
                        class="w-full flex items-center justify-center gap-1 border border-cyan-500 text-cyan-600 hover:bg-cyan-500 hover:text-white font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-opacity-50">
                            <svg class="size-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                            </svg>
                            Reservas de {{ reserva.clase.get_direccion_corta }}
                        </a>
                        
                        <a href="{% url 'gravity:admin_agregar_usuario' %}?clase_id={{ reserva.clase.id }}" 
                        class="w-full flex items-center justify-center gap-1 border border-green-500 text-green-600 hover:bg-green-500 hover:text-white font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                            <svg class="size-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                            </svg>
                            Agregar Otro Cliente
                        </a>
                    </div>
                </div>
            </div>

            <!-- Actividad Reciente -->
            <div class="card">
                <div class="card-header text-blanco">
                    <h6 class="flex items-center gap-2">
                        <svg class="size-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        Actividad Reciente
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="timeline">
                        <div class="timeline-item flex items-center gap-1">
                            <svg class="size-6 text-green-800" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/>
                            </svg>
                            <div class="mt-0.5">
                                <small class="text-gris-medio">{{ reserva.fecha_reserva|date:"d/m/Y H:i" }}</small>
                                <div>Reserva creada en {{ reserva.clase.get_direccion_corta }}</div>
                            </div>
                        </div>
                        
                        {% if reserva.fecha_modificacion != reserva.fecha_reserva %}
                            <div class="timeline-item flex items-center gap-1">
                                <svg class="size-5 text-blue-700" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                </svg>
                                <div>
                                    <small class="text-gris-medio">{{ reserva.fecha_modificacion|date:"d/m/Y H:i" }}</small>
                                    <div>Última modificación</div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <hr class="my-2 border-principal/30">
                    
                    <small class="text-gris-medio">
                        <svg class="inline-block w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        Esta reserva es recurrente y se repite cada {{ reserva.clase.dia }} en {{ reserva.clase.get_direccion_corta }}.
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación -->
    <div id="confirmModal" class="fixed inset-0 z-[9999] hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity"></div>
        
        <!-- Modal container -->
        <div class="fixed inset-0 z-[10000] overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4">
                <!-- Modal panel -->
                <div class="relative bg-white rounded-lg shadow-xl max-w-lg w-full transform transition-all">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <!-- Header -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100">
                                    <svg class="size-8 text-yellow-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <h3 class="text-2xl leading-6 font-medium text-gray-900" id="modal-title">
                                        Confirmar Cancelación
                                    </h3>
                                </div>
                            </div>
                            <button type="button" class="text-gray-400 hover:text-gray-600 focus:outline-none transition-colors" id="closeModal">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Content -->
                        <div class="mt-3">
                            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                                <p class="text-md text-blue-700 font-medium">
                                    ¿Estás seguro de que quieres cancelar esta reserva?
                                </p>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <h4 class="font-medium text-gray-700 mb-1">Usuario:</h4>
                                        <p class="text-gray-600 text-sm" id="modal-usuario"></p>
                                    </div>
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <h4 class="font-medium text-gray-700 mb-1">Reserva:</h4>
                                        <p class="text-gray-600 text-sm" id="modal-reserva"></p>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-medium text-gray-700 mb-1">Clase:</h4>
                                    <p class="text-gray-600 text-sm" id="modal-clase"></p>
                                </div>
                                
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-medium text-gray-700 mb-1">Sede:</h4>
                                    <p class="text-gray-600 text-sm" id="modal-sede"></p>
                                </div>
                                
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-medium text-gray-700 mb-1">Motivo:</h4>
                                    <p class="text-gray-600 text-sm" id="modal-motivo"></p>
                                </div>
                                
                                <div class="bg-red-50 border-l-4 border-red-400 p-4">
                                    <div class="flex items-center gap-2">
                                        <svg class="size-6 text-red-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                        </svg>
                                        <p class="text-sm text-red-700">
                                            <strong>Atención:</strong> Esta acción NO se puede deshacer.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer -->
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 flex flex-col sm:flex-row items-center justify-center gap-3">
                        <button type="button" class="w-full sm:w-auto inline-flex justify-center items-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors" id="confirmCancelAction">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"/>
                            </svg>
                            <span id="confirmTextModal">Sí, Cancelar Reserva</span>
                        </button>
                        <button type="button" class="w-full sm:w-auto inline-flex justify-center items-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors" id="cancelModalAction">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_css %}
    <style>
        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1rem;
        }

        .timeline-item svg {
            position: absolute;
            left: -2rem;
            top: 0.25rem;
            width: 1.5rem;
            text-align: center;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: -1.25rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e9ecef;
        }

        .color-text {
            color: #7e661d;
        }

        .border-left-primary {
            border-left: 4px solid #FFC107 !important;
        }

        .user-avatar {
            background: linear-gradient(135deg, #5D768B 0%, #C8B39B 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Estilos para el modal de confirmación */
        #confirmModal.hidden {
            display: none !important;
        }

        #confirmModal:not(.hidden) {
            display: block !important;
        }

        /* Animación suave para el modal */
        #confirmModal .transform {
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }

        #confirmModal:not(.hidden) .transform {
            transform: scale(1);
            opacity: 1;
        }
    </style>
{% endblock %}

{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('cancelForm');
            const confirmBtn = document.getElementById('confirmCancelBtn');
            const cancelText = document.getElementById('cancelText');
            const motivoSelect = document.getElementById('motivo');
            const motivoDetalle = document.getElementById('motivo_detalle');
            
            // Mostrar/ocultar el área de detalle según la selección
            motivoSelect.addEventListener('change', function() {
                if (this.value === 'Otro') {
                    motivoDetalle.required = true;
                    motivoDetalle.placeholder = 'Por favor, especifica el motivo de la cancelación...';
                } else {
                    motivoDetalle.required = false;
                    motivoDetalle.placeholder = 'Describe el motivo de la cancelación con más detalle (opcional)...';
                }
            });
            
            // Envío del formulario con confirmación
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const motivo = motivoSelect.value;
                if (!motivo) {
                    // Crear un pequeño tooltip de error en lugar de alert
                    motivoSelect.classList.add('border-red-500');
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'text-red-500 text-sm mt-1';
                    errorMsg.textContent = 'Por favor, selecciona un motivo para la cancelación.';
                    motivoSelect.parentNode.appendChild(errorMsg);
                    motivoSelect.focus();
                    
                    setTimeout(() => {
                        motivoSelect.classList.remove('border-red-500');
                        if (errorMsg.parentNode) {
                            errorMsg.parentNode.removeChild(errorMsg);
                        }
                    }, 3000);
                    return;
                }
                
                const userName = '{{ reserva.get_nombre_completo_usuario }}';
                const className = '{{ reserva.clase.get_nombre_display }} - {{ reserva.clase.dia }} {{ reserva.clase.horario|time:"H:i" }}';
                const sede = '{{ reserva.clase.get_direccion_corta }}';
                const reservaNumber = '{{ reserva.numero_reserva }}';
                
                // Llenar los datos del modal
                document.getElementById('modal-usuario').textContent = userName;
                document.getElementById('modal-clase').textContent = className;
                document.getElementById('modal-sede').textContent = sede;
                document.getElementById('modal-reserva').textContent = reservaNumber;
                document.getElementById('modal-motivo').textContent = motivo;
                
                // Mostrar el modal
                document.getElementById('confirmModal').classList.remove('hidden');
            });

            // Cerrar modal
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('confirmModal').classList.add('hidden');
            });

            document.getElementById('cancelModalAction').addEventListener('click', function() {
                document.getElementById('confirmModal').classList.add('hidden');
            });

            // Cerrar modal al hacer clic fuera
            document.getElementById('confirmModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });

            // Manejar la confirmación del modal
            document.getElementById('confirmCancelAction').addEventListener('click', function() {
                const confirmBtn = this;
                const confirmText = document.getElementById('confirmTextModal');
                
                // Mostrar estado de carga
                confirmText.textContent = 'Cancelando...';
                confirmBtn.disabled = true;
                confirmBtn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>' + confirmText.textContent;
                
                // Ocultar el modal
                document.getElementById('confirmModal').classList.add('hidden');
                
                // Mostrar estado de carga en el botón principal también
                cancelText.textContent = 'Cancelando...';
                confirmCancelBtn.disabled = true;
                confirmCancelBtn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>' + cancelText.textContent;
                
                // Enviar el formulario después de un breve retraso
                setTimeout(function() {
                    form.submit();
                }, 1000);
            });
            
            // Agrega efectos hover a los botones
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(function(button) {
                button.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-1px)';
                    this.style.transition = 'transform 0.2s ease';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
{% endblock %}