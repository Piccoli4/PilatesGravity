{% extends 'gravity/admin/base_admin.html' %}

{% block title %}Agregar Cliente No Registrado - Panel de Administración{% endblock %}

{% block breadcrumb %}
    <li class="flex items-center">
        <span class="text-gray-400">/</span>
        <a href="{% url 'gravity:admin_clientes_no_registrados_lista' %}" class="ml-1 text-principal hover:text-principal/80 transition-colors duration-200">
            Clientes No Registrados
        </a>
    </li>
    <li class="flex items-center">
        <span class="text-gray-400">/</span>
        <span class="ml-1 text-gray-500">Agregar Cliente</span>
    </li>
{% endblock %}

{% block content %}
{% load static %}
<!-- Header Section -->
<div class="grid grid-cols-1 gap-4 mb-6">
    <div class="card">
        <div class="card-body p-3">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-2xl text-gris-oscuro mb-2 flex items-center gap-2">
                        <svg class="size-8 mb-1" fill="currentColor" viewBox="0 0 640 640" xmlns="http://www.w3.org/2000/svg">
                            <path d="M136 192C136 125.7 189.7 72 256 72C322.3 72 376 125.7 376 192C376 258.3 322.3 312 256 312C189.7 312 136 258.3 136 192zM48 546.3C48 447.8 127.8 368 226.3 368L285.7 368C384.2 368 464 447.8 464 546.3C464 562.7 450.7 576 434.3 576L77.7 576C61.3 576 48 562.7 48 546.3zM544 160C557.3 160 568 170.7 568 184L568 232L616 232C629.3 232 640 242.7 640 256C640 269.3 629.3 280 616 280L568 280L568 328C568 341.3 557.3 352 544 352C530.7 352 520 341.3 520 328L520 280L472 280C458.7 280 448 269.3 448 256C448 242.7 458.7 232 472 232L520 232L520 184C520 170.7 530.7 160 544 160z"/>
                        </svg>
                        Agregar Cliente No Registrado
                    </h2>
                    <p class="text-gris-medio">
                        Agrega un cliente directamente a una clase sin necesidad de registro previo
                    </p>
                </div>
                <div class="flex items-center">
                    <a 
                        href="{% url 'gravity:admin_clientes_no_registrados_lista' %}" 
                        class="flex items-center gap-1 border border-principal text-principal hover:bg-principal hover:text-fondo font-medium py-2 px-4 rounded-l transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                    >
                        <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                        </svg>
                        Ver Lista
                    </a>
                    <a 
                        href="{% url 'gravity:admin_clases_lista' %}" 
                        class="flex items-center gap-1 border border-secundario bg-secundario text-fondo hover:bg-blanco hover:text-secundario font-medium py-2 px-4 rounded-r transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-opacity-50"
                    >
                        <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Ver Clases
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Info Banner -->
<div class="grid grid-cols-1 gap-4 mb-6">
    <div class="bg-info/10 border border-info/20 rounded-lg p-4">
        <div class="flex items-start gap-2">
            <svg class="size-10 text-info" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
            <div>
                <h6 class="font-semibold text-gris-oscuro mb-1">¿Cuándo usar esta función?</h6>
                <p class="text-gris-medio">
                    <strong>Úsala para:</strong> Clientes que prefieren no registrarse, reservas telefónicas, clases de prueba, o situaciones especiales donde necesitas agregar rápidamente a alguien a una clase.
                    El email es opcional pero recomendado para futuras comunicaciones.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Formulario Principal - 2/3 del ancho en pantallas grandes -->
    <div class="lg:col-span-2">
        <div class="card">
            <div class="card-header">
                <h5 class="flex items-center gap-2">
                    <svg class="size-6" fill="currentColor" viewBox="0 0 640 640" xmlns="http://www.w3.org/2000/svg">
                        <path d="M256.1 312C322.4 312 376.1 258.3 376.1 192C376.1 125.7 322.4 72 256.1 72C189.8 72 136.1 125.7 136.1 192C136.1 258.3 189.8 312 256.1 312zM226.4 368C127.9 368 48.1 447.8 48.1 546.3C48.1 562.7 61.4 576 77.8 576L274.3 576L285.2 521.5C289.5 499.8 300.2 479.9 315.8 464.3L383.1 397C355.1 378.7 321.7 368.1 285.7 368.1L226.3 368.1zM332.3 530.9L320.4 590.5C320.2 591.4 320.1 592.4 320.1 593.4C320.1 601.4 326.6 608 334.7 608C335.7 608 336.6 607.9 337.6 607.7L397.2 595.8C409.6 593.3 421 587.2 429.9 578.3L548.8 459.4L468.8 379.4L349.9 498.3C341 507.2 334.9 518.6 332.4 531zM600.1 407.9C622.2 385.8 622.2 350 600.1 327.9C578 305.8 542.2 305.8 520.1 327.9L491.3 356.7L571.3 436.7L600.1 407.9z"/>
                    </svg>
                    Datos del Cliente
                </h5>
            </div>
            <div class="card-body p-3">
                <form method="post" id="clienteForm">
                    {% csrf_token %}
                    
                    <!-- Información del Cliente -->
                    <div class="mb-6">
                        <div class="mb-4">
                            <h6 class="text-lg font-semibold text-principal flex items-center gap-1">
                                <svg class="size-5 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                Información Personal
                            </h6>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="nombre" class="flex items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                    <svg class="size-4 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    Nombre *
                                </label>
                                <input type="text" 
                                       name="nombre" 
                                       id="nombre" 
                                       class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200" 
                                       placeholder="Ej: María"
                                       value="{{ form_data.nombre|default:'' }}"
                                       required>
                                <div class="mt-1">
                                    <small class="text-gris-medio">Nombre de pila del cliente</small>
                                </div>
                            </div>
                            
                            <div>
                                <label for="apellido" class="flex items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                    <svg class="size-4 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    Apellido *
                                </label>
                                <input type="text" 
                                       name="apellido" 
                                       id="apellido" 
                                       class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200" 
                                       placeholder="Ej: González"
                                       value="{{ form_data.apellido|default:'' }}"
                                       required>
                                <div class="mt-1">
                                    <small class="text-gris-medio">Apellido del cliente</small>
                                </div>
                            </div>
                            
                            <div>
                                <label for="telefono" class="flex items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                    <svg class="size-4 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                    Teléfono *
                                </label>
                                <input type="tel" 
                                       name="telefono" 
                                       id="telefono" 
                                       class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200" 
                                       placeholder="Ej: +54 11 1234-5678"
                                       value="{{ form_data.telefono|default:'' }}"
                                       required>
                                <div class="mt-1">
                                    <small class="text-gris-medio">Número de contacto del cliente</small>
                                </div>
                            </div>
                            
                            <div>
                                <label for="email" class="flex items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                    <svg class="size-4 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    Email (Opcional)
                                </label>
                                <input type="email" 
                                       name="email" 
                                       id="email" 
                                       class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200" 
                                       placeholder="Ej: maria@email.com"
                                       value="{{ form_data.email|default:'' }}">
                                <div class="mt-1">
                                    <small class="text-gris-medio">Para enviar confirmaciones y recordatorios</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Selección de Clase -->
                    <div class="mb-6">
                        <div class="mb-4">
                            <h6 class="text-lg font-semibold text-principal flex items-center gap-1.5">
                                <svg class="size-5 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                Selección de Clase
                            </h6>
                        </div>
                        
                        <div>
                            <label for="clase_id" class="flex items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                <svg class="size-4 mb-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                                Clase *
                            </label>
                            <select name="clase_id" 
                                    id="clase_id" 
                                    class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200 bg-white" 
                                    required>
                                <option value="">Selecciona una clase disponible</option>
                                {% for item in clases_disponibles %}
                                    <option value="{{ item.clase.id }}" 
                                            data-tipo="{{ item.clase.tipo }}" 
                                            data-dia="{{ item.clase.dia }}" 
                                            data-horario="{{ item.clase.horario|time:'H:i' }}" 
                                            data-cupos="{{ item.cupos_disponibles }}">
                                        {{ item.clase.get_tipo_display }} - {{ item.clase.dia }} {{ item.clase.horario|time:"H:i" }} 
                                        ({{ item.cupos_disponibles }} cupos disponibles)
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="mt-1">
                                <small class="text-gris-medio">Solo se muestran clases activas con cupos disponibles</small>
                            </div>
                        </div>
                    </div>

                    <!-- Vista Previa de la Clase -->
                    <div class="mb-6">
                        <div class="card bg-gris-claro border-0" id="clasePreview" style="display: none;">
                            <div class="card-header bg-exito text-white">
                                <h6 class="flex items-center gap-1 font-semibold">
                                    <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                    </svg>
                                    Vista Previa de la Reserva
                                </h6>
                            </div>
                            <div class="card-body p-3">
                                <div id="previewContent" class="text-center">
                                    <!-- La Vista previa de la clase seleccionada se mostrará aquí -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notas Adicionales -->
                    <div class="mb-6">
                        <div class="mb-4">
                            <h6 class="text-lg font-semibold text-principal flex items-center gap-1">
                                <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v6a2 2 0 01-2 2h-2l-4 4z"></path>
                                </svg>
                                Información Adicional (Opcional)
                            </h6>
                        </div>
                        
                        <div>
                            <label for="notas" class="flex items-center gap-1 text-sm font-medium text-gris-oscuro mb-2">
                                <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                Notas
                            </label>
                            <textarea name="notas" 
                                      id="notas" 
                                      class="w-full px-4 py-3 border border-gris-medio/30 rounded-lg focus:ring-2 focus:ring-principal/20 focus:border-principal transition-colors duration-200 resize-none" 
                                      rows="3" 
                                      placeholder="Notas adicionales sobre este cliente (ej: derivado por..., primera vez, necesidades especiales, etc.)">{{ form_data.notas|default:'' }}</textarea>
                            <div class="ml-1">
                                <small class="text-gris-medio">Información que puede ser útil para las clases</small>
                            </div>
                        </div>
                    </div>

                    <!-- Opciones -->
                    <div class="mb-6">
                        <div class="mb-4">
                            <h6 class="text-lg font-semibold text-principal flex items-center gap-1">
                                <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Opciones
                            </h6>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-start">
                                <input type="checkbox" 
                                       name="enviar_confirmacion" 
                                       id="enviar_confirmacion" 
                                       class="mt-1 h-4 w-4 text-principal border-gris-medio rounded focus:ring-principal/20"
                                       checked>
                                <label class="ml-3 text-sm text-gris-oscuro flex items-center" for="enviar_confirmacion">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    Enviar confirmación por email (si se proporcionó email)
                                </label>
                            </div>
                            
                            <div class="flex items-start">
                                <input type="checkbox" 
                                       name="crear_como_recurrente" 
                                       id="crear_como_recurrente" 
                                       class="mt-1 h-4 w-4 text-principal border-gris-medio rounded focus:ring-principal/20"
                                       checked>
                                <label class="ml-3 text-sm text-gris-oscuro flex items-center" for="crear_como_recurrente">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Crear como reserva recurrente (cada semana en el mismo horario)
                                </label>
                            </div>
                            
                            <div class="flex items-start">
                                <input type="checkbox" 
                                       name="sugerir_registro" 
                                       id="sugerir_registro"
                                       class="mt-1 h-4 w-4 text-principal border-gris-medio rounded focus:ring-principal/20">
                                <label class="ml-3 text-sm text-gris-oscuro flex items-center" for="sugerir_registro">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                                    </svg>
                                    Sugerir al cliente que se registre en el sistema (en email de confirmación)
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Warning Section -->
                    <div class="mb-6">
                        <div class="bg-advertencia/10 border border-advertencia/70 rounded-lg p-4">
                            <div class="flex items-start">
                                <svg class="w-5 h-5 text-advertencia mr-3 mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <strong class="text-gris-oscuro">Importante:</strong>
                                    <ul class="mt-2 text-sm text-gris-medio space-y-1">
                                        <li>• Este cliente será agregado al sistema pero sin cuenta de usuario</li>
                                        <li>• No podrá modificar ni cancelar su reserva por sí mismo</li>
                                        <li>• Todas las modificaciones deberán hacerse desde el panel de administración</li>
                                        <li>• Si posteriormente se registra, podrás vincular ambas cuentas</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="flex items-center justify-center gap-3">
                        <a href="{% url 'gravity:admin_clientes_no_registrados_lista' %}" 
                           class="flex items-center gap-1 border border-gray-400 text-gray-700 hover:bg-gray-300 font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50">
                            <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            Cancelar
                        </a>
                        
                        <button type="submit" 
                                class="flex items-center gap-1 bg-principal text-fondo hover:bg-fondo hover:text-principal font-medium py-2 px-4 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50" 
                                id="submitBtn">
                            <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                            </svg>
                            <span id="submitText">Agregar Cliente y Reservar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Barra lateral de información - 1/3 del ancho en pantallas grandes -->
    <div class="space-y-6">
        <!-- Tips Rápidos -->
        <div class="card">
            <div class="card-header text-blanco">
                <h6 class="flex items-center gap-2">
                    <svg class="size-5 mb-0.5" fill="currentColor" viewBox="0 0 640 640" xmlns="http://www.w3.org/2000/svg">
                        <path d="M420.9 448C428.2 425.7 442.8 405.5 459.3 388.1C492 353.7 512 307.2 512 256C512 150 426 64 320 64C214 64 128 150 128 256C128 307.2 148 353.7 180.7 388.1C197.2 405.5 211.9 425.7 219.1 448L420.8 448zM416 496L224 496L224 512C224 556.2 259.8 592 304 592L336 592C380.2 592 416 556.2 416 512L416 496zM312 176C272.2 176 240 208.2 240 248C240 261.3 229.3 272 216 272C202.7 272 192 261.3 192 248C192 181.7 245.7 128 312 128C325.3 128 336 138.7 336 152C336 165.3 325.3 176 312 176z"/>
                    </svg>
                    Consejos Rápidos
                </h6>
            </div>
            <div class="card-body p-3">
                <div class="space-y-4">
                    <div class="flex flex-col items-start">
                        <div class="flex items-center gap-1">
                            <svg class="size-5 text-exito" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            <strong class="text-gris-oscuro">Datos mínimos:</strong>
                        </div>
                        <small class="block text-gris-medio">Solo necesitas nombre, apellido y teléfono</small>
                    </div>
                    
                    <div class="flex flex-col items-start">
                        <div class="flex items-center gap-1">
                            <svg class="size-5 text-principal" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                            <strong class="text-gris-oscuro">Email opcional:</strong>
                        </div>
                        <small class="block text-gris-medio">Pero muy recomendado para confirmaciones</small>
                    </div>
                    
                    <div class="flex flex-col items-start">
                        <div class="flex items-center gap-1">
                            <svg class="size-5 text-advertencia" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            <strong class="text-gris-oscuro">Reservas recurrentes:</strong>
                        </div>
                        <small class="block text-gris-medio">El cliente asistirá cada semana hasta cancelar</small>
                    </div>
                    
                    <div class="flex flex-col items-start">
                        <div class="flex items-center gap-1">
                            <svg class="size-5 text-info" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <strong class="text-gris-oscuro">Gestión posterior:</strong>
                        </div>
                        <small class="block text-gris-medio">Podrás modificar o cancelar desde la lista de clientes</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Classes Summary -->
        <div class="card">
            <div class="card-header text-blanco">
                <h6 class="flex items-center gap-2">
                    <svg class="size-5 mb-0.5" fill="currentColor" viewBox="0 0 576 512" xmlns="http://www.w3.org/2000/svg">
                        <path d="M512.4 240l-176 0c-17.7 0-32-14.3-32-32l0-176c0-17.7 14.4-32.2 31.9-29.9 107 14.2 191.8 99 206 206 2.3 17.5-12.2 31.9-29.9 31.9zM222.6 37.2c18.1-3.8 33.8 11 33.8 29.5l0 197.3c0 5.6 2 11 5.5 15.3L394 438.7c11.7 14.1 9.2 35.4-6.9 44.1-34.1 18.6-73.2 29.2-114.7 29.2-132.5 0-240-107.5-240-240 0-115.5 81.5-211.9 190.2-234.8zM477.8 288l64 0c18.5 0 33.3 15.7 29.5 33.8-10.2 48.4-35 91.4-69.6 124.2-12.3 11.7-31.6 9.2-42.4-3.9L374.9 340.4c-17.3-20.9-2.4-52.4 24.6-52.4l78.2 0z"/>
                    </svg>
                    Estado de las Clases
                </h6>
            </div>
            <div class="card-body p-3">
                {% if clases_disponibles %}
                    <div class="space-y-3">
                        <div class="flex justify-between items-center text-xl">
                            <span class="text-gris-oscuro">Clases disponibles:</span>
                            <strong class="text-exito">{{ clases_disponibles|length }}</strong>
                        </div>
                        
                        <div>
                            <h3 class="text-gris-medio text-lg">Por tipo:</h3>
                            <div class="mt-2 space-y-1">
                                {% regroup clases_disponibles by clase.tipo as clases_por_tipo %}
                                {% for tipo in clases_por_tipo %}
                                    <div class="flex justify-between items-center text-sm">
                                        <p class="text-gris-oscuro">{{ tipo.grouper }}</p>
                                        <p class="text-principal font-medium">{{ tipo.list|length }}</p>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <hr class="border-principal/20">
                        
                        <div class="text-center">
                            <a href="{% url 'gravity:admin_clase_crear' %}" 
                               class="flex items-center justify-center gap-1 border border-principal text-principal hover:bg-principal hover:text-fondo text-lg py-2 px-3 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50"
                            >
                                <svg class="size-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Crear Nueva Clase
                            </a>
                        </div>
                    </div>
                {% else %}
                    <div class="text-center py-6">
                        <svg class="w-12 h-12 text-advertencia mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        <p class="text-gris-medio mb-4">No hay clases disponibles con cupos libres</p>
                        <a 
                            href="{% url 'gravity:admin_clase_crear' %}" 
                            class="flex items-center justify-center gap-1 bg-principal text-fondo hover:bg-secundario hover:text-principal text-lg py-2 rounded transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                        >
                            <svg class="size-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Crear Clase
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('clienteForm');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const claseSelect = document.getElementById('clase_id');
        const previewCard = document.getElementById('clasePreview');
        const previewContent = document.getElementById('previewContent');
        const emailInput = document.getElementById('email');
        const enviarConfirmacion = document.getElementById('enviar_confirmacion');
        
        // Actualizar vista previa cuando cambia la clase
        claseSelect.addEventListener('change', function() {
            updateClassPreview();
            updateEmailOptions();
        });
        
        // Actualizar opciones de email cuando cambia el email
        emailInput.addEventListener('input', updateEmailOptions);
        
        function updateClassPreview() {
            const selectedOption = claseSelect.options[claseSelect.selectedIndex];
            
            if (selectedOption.value) {
                const tipo = selectedOption.dataset.tipo;
                const dia = selectedOption.dataset.dia;
                const horario = selectedOption.dataset.horario;
                const cupos = selectedOption.dataset.cupos;
                
                // Determinar la imagen según el tipo de clase
                let imageName;
                if (tipo === 'Reformer') {
                    imageName = 'reformer.png';
                } else if (tipo === 'Cadillac') {
                    imageName = 'cadillac.png';
                } else {
                    imageName = 'especial.png';
                }
                
                const tipoDisplay = selectedOption.textContent.split(' - ')[0];
                
                previewContent.innerHTML = 
                    '<div class="flex flex-col md:flex-row gap-4 items-center justify-evenly">' +
                        '<div class="text-center">' +
                            '<img src="/static/icons/' + imageName + '" alt="' + tipo + '" class="w-16 h-16 mx-auto mb-2 object-contain">' +
                            '<h6 class="font-semibold mt-2 text-principal">' + tipoDisplay + '</h6>' +
                        '</div>' +
                        '<div>' +
                            '<h6 class="text-principal text-left font-semibold mb-3">Detalles de la Reserva:</h6>' +
                            '<div class="text-left space-y-2">' +
                                '<div class="flex items-center gap-1"><svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><strong>Día:</strong> ' + dia + '</div>' +
                                '<div class="flex items-center gap-1"><svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><strong>Horario:</strong> ' + horario + '</div>' +
                                '<div class="flex items-center gap-1"><svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><strong>Cupos disponibles:</strong> ' + cupos + '</div>' +
                                '<div class="flex items-center gap-1"><svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><strong>Recurrencia:</strong> Cada ' + dia + ' a las ' + horario + '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>';
                
                previewCard.style.display = 'block';
            } else {
                previewCard.style.display = 'none';
            }
        }
        
        function updateEmailOptions() {
            const hasEmail = emailInput.value.trim() !== '';
            enviarConfirmacion.disabled = !hasEmail;
            
            const label = document.querySelector('label[for="enviar_confirmacion"]');
            if (hasEmail) {
                label.classList.remove('text-gris-medio');
                label.classList.add('text-gris-oscuro');
                enviarConfirmacion.checked = true;
            } else {
                label.classList.add('text-gris-medio');
                label.classList.remove('text-gris-oscuro');
                enviarConfirmacion.checked = false;
            }
        }
        
        // Envío del formulario
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validar campos obligatorios
            const requiredFields = ['nombre', 'apellido', 'telefono', 'clase_id'];
            let isValid = true;
            
            requiredFields.forEach(function(fieldId) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.classList.add('border-error');
                    field.classList.remove('border-gris-medio/30');
                    isValid = false;
                } else {
                    field.classList.remove('border-error');
                    field.classList.add('border-gris-medio/30');
                }
            });
            
            // Validar formato de email si se proporciona
            const email = emailInput.value.trim();
            if (email && !isValidEmail(email)) {
                emailInput.classList.add('border-error');
                emailInput.classList.remove('border-gris-medio/30');
                isValid = false;
            } else {
                emailInput.classList.remove('border-error');
                emailInput.classList.add('border-gris-medio/30');
            }
            
            if (!isValid) {
                alert('Por favor, completa todos los campos obligatorios correctamente.');
                return;
            }
            
            // Mostrar estado de carga
            submitText.textContent = 'Procesando...';
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>' + submitText.textContent;
            
            // Enviar formulario
            setTimeout(function() {
                form.submit();
            }, 1000);
        });
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
               
        // Auto-focus el primer campo
        document.getElementById('nombre').focus();
        
        // Inicializar opciones de email
        updateEmailOptions();
    });
</script>
{% endblock %}