{% extends 'gravity/admin/base_admin.html' %}

{% block title %}Detalle de Clase - Panel de Administración{% endblock %}

{% block breadcrumb %}
    <li class="flex items-center">
        <span class="text-gray-400">/</span>
        <a href="{% url 'gravity:admin_clases_lista' %}" class="ml-1 text-principal hover:text-principal/80 transition-colors duration-200">
            Clases
        </a>
    </li>
    <li class="flex items-center">
        <span class="text-gray-400">/</span>
        <span class="ml-1 text-gray-500">Detalle</span>
    </li>
{% endblock %}

{% block content %}
    {% load static %}
    <!-- Header Section -->
    <div class="mb-4">
        <div class="p-4 bg-blanco rounded-lg shadow-sm">
            <div class="flex flex-col md:flex-row md:items-center justify-between">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-3xl text-principal mb-2 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="size-10" fill="currentColor">
                            <path d="M224 64C241.7 64 256 78.3 256 96L256 128L384 128L384 96C384 78.3 398.3 64 416 64C433.7 64 448 78.3 448 96L448 128L480 128C515.3 128 544 156.7 544 192L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 192C96 156.7 124.7 128 160 128L192 128L192 96C192 78.3 206.3 64 224 64zM160 304L160 336C160 344.8 167.2 352 176 352L208 352C216.8 352 224 344.8 224 336L224 304C224 295.2 216.8 288 208 288L176 288C167.2 288 160 295.2 160 304zM288 304L288 336C288 344.8 295.2 352 304 352L336 352C344.8 352 352 344.8 352 336L352 304C352 295.2 344.8 288 336 288L304 288C295.2 288 288 295.2 288 304zM432 288C423.2 288 416 295.2 416 304L416 336C416 344.8 423.2 352 432 352L464 352C472.8 352 480 344.8 480 336L480 304C480 295.2 472.8 288 464 288L432 288zM160 432L160 464C160 472.8 167.2 480 176 480L208 480C216.8 480 224 472.8 224 464L224 432C224 423.2 216.8 416 208 416L176 416C167.2 416 160 423.2 160 432zM304 416C295.2 416 288 423.2 288 432L288 464C288 472.8 295.2 480 304 480L336 480C344.8 480 352 472.8 352 464L352 432C352 423.2 344.8 416 336 416L304 416zM416 432L416 464C416 472.8 423.2 480 432 480L464 480C472.8 480 480 472.8 480 464L480 432C480 423.2 472.8 416 464 416L432 416C423.2 416 416 423.2 416 432z"/>
                        </svg>
                        Detalle de Clase
                    </h2>
                    <p class="text-gray-600 mb-0">
                        Información completa y reservas de la clase
                    </p>
                </div>
                <div class="flex space-x-2">
                    <a href="{% url 'gravity:admin_clases_lista' %}" class="btn bg-gray-200 hover:bg-gray-300 text-gray-700 border border-gray-300 px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Volver
                    </a>
                    <a href="{% url 'gravity:admin_clase_editar' clase.id %}" class="btn bg-principal hover:bg-principal/90 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        Editar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Class Information -->
    <div class="grid grid-cols-12 gap-4 mb-4">
        <div class="col-span-12 lg:col-span-8">
            <div class="">
                <div class="card-header">
                    <h5 class="text-lg font-semibold text-blanco flex items-center gap-2">
                        <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Información de la Clase
                    </h5>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
                    <div class="text-center mb-4">
                        {% if clase.tipo == 'Reformer' %}
                            <img src="{% static 'icons/reformer.png' %}" alt="Icono de Reformer" class="w-16 h-16 mx-auto mb-3">
                        {% elif clase.tipo == 'Cadillac' %}
                            <img src="{% static 'icons/cadillac.png' %}" alt="Icono de Cadillac" class="w-16 h-16 mx-auto mb-3">
                        {% else %}
                            <img src="{% static 'icons/especial.png' %}" alt="Icono de Clase Especial" class="w-16 h-16 mx-auto mb-3">
                        {% endif %}
                        <h3 class="text-principal text-xl font-bold mb-1">{{ clase.get_nombre_display }}</h3>
                        <p class="text-gray-600 mb-0 flex items-center justify-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            {{ clase.dia }} - 
                            <svg class="w-4 h-4 mx-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            {{ clase.horario|time:"H:i" }}
                        </p>
                        {% if clase.activa %}
                            <span class="inline-block px-2 py-1 bg-green-700 text-blanco text-sm font-medium rounded-lg mt-2">Clase Activa</span>
                        {% else %}
                            <span class="inline-block px-2 py-1 bg-red-700 text-blanco text-sm font-medium rounded-lg mt-2">Clase Inactiva</span>
                        {% endif %}
                    </div>
                    
                    <div>
                        <h6 class="text-base font-semibold mb-3">Datos Generales:</h6>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center py-1 border-b border-gray-300">
                                <strong class="text-gray-600">ID de Clase:</strong>
                                <span class="inline-block px-2 py-1 bg-secundario text-gray-800 text-xs font-medium rounded">{{ clase.id }}</span>
                            </div>
                            <div class="flex justify-between items-center py-1 border-b border-gray-300">
                                <strong class="text-gray-700">Tipo:</strong>
                                <span class="text-gray-600">{{ clase.get_tipo_display }}</span>
                            </div>
                            <div class="flex justify-between items-center py-1 border-b border-gray-300">
                                <strong class="text-gray-700">Día de la Semana:</strong>
                                <span class="text-gray-600">{{ clase.dia }}</span>
                            </div>
                            <div class="flex justify-between items-center py-1 border-b border-gray-300">
                                <strong class="text-gray-700">Horario:</strong>
                                <span class="text-gray-600">{{ clase.horario|time:"H:i" }}</span>
                            </div>
                            <div class="flex justify-between items-center py-1 border-b border-gray-300">
                                <strong class="text-gray-700">Cupo Máximo:</strong>
                                <span class="text-gray-600">{{ clase.cupo_maximo }} personas</span>
                            </div>
                            <div class="flex justify-between items-center py-1 border-b border-gray-300">
                                <strong class="text-gray-700">Estado:</strong>
                                {% if clase.activa %}
                                    <span class="inline-block px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded">Activa</span>
                                {% else %}
                                    <span class="inline-block px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded">Inactiva</span>
                                {% endif %}
                            </div>
                            <div class="flex justify-between items-center py-1 border-b border-gray-300">
                                <strong class="text-gray-700">Fecha de Creación:</strong>
                                <span class="text-gray-600">{{ clase.fecha_creacion|date:"d/m/Y H:i" }}</span>
                            </div>
                            <div class="flex justify-between items-center py-1">
                                <strong class="text-gray-700">Última Modificación:</strong>
                                <span class="text-gray-600">{{ clase.fecha_modificacion|date:"d/m/Y H:i" }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="col-span-12 lg:col-span-4">
            <div class="space-y-3">
                <div class="card bg-principal text-white">
                    <div class="flex flex-col items-center justify-center gap-2 p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-10">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" />
                        </svg>
                        <h3 class="text-2xl font-bold mb-1">{{ total_reservas }}</h3>
                        <small>Reservas Activas</small>
                    </div>
                </div>
                
                <div class="card bg-exito text-white">
                    <div class="flex flex-col items-center justify-center gap-2 p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-10">
                            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
                        </svg>
                        <h3 class="text-2xl font-bold mb-1">{{ cupos_disponibles }}</h3>
                        <small>Cupos Disponibles</small>
                    </div>
                </div>
                
                <div class="card bg-info text-white">
                    <div class="flex flex-col items-center justify-center gap-2 p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="size-10">
                            <path d="M544.4 304L368.4 304C350.7 304 336.4 289.7 336.4 272L336.4 96C336.4 78.3 350.8 63.8 368.3 66.1C475.3 80.3 560.1 165.1 574.3 272.1C576.6 289.6 562.1 304 544.4 304zM254.6 101.2C272.7 97.4 288.4 112.2 288.4 130.7L288.4 328C288.4 333.6 290.4 339 293.9 343.3L426 502.7C437.7 516.8 435.2 538.1 419.1 546.8C385 565.4 345.9 576 304.4 576C171.9 576 64.4 468.5 64.4 336C64.4 220.5 145.9 124.1 254.6 101.2zM509.8 352L573.8 352C592.3 352 607.1 367.7 603.3 385.8C593.1 434.2 568.3 477.2 533.7 510C521.4 521.7 502.1 519.2 491.3 506.1L406.9 404.4C389.6 383.5 404.5 352 431.5 352L509.7 352z"/>
                        </svg>
                        <h3 class="text-2xl font-bold mb-1">{{ porcentaje_ocupacion }}%</h3>
                        <small>Ocupación</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Occupancy Visual -->
    <div class="grid grid-cols-12 gap-4 mb-4">
        <div class="col-span-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="text-lg font-semibold text-blanco flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Estado de Ocupación
                    </h5>
                </div>
                <div class="card-body">
                    <div class="grid grid-cols-1 gap-6 items-center">
                        <div class="flex-1 p-3">
                            <div class="mb-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Ocupación Actual</span>
                                    <span class="font-bold text-gray-800">{{ total_reservas }}/{{ clase.cupo_maximo }}</span>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-5 mb-3">
                                <div class="h-5 rounded-full transition-all duration-1000 ease-in-out
                                    {% if porcentaje_ocupacion == 100 %}bg-red-700
                                    {% elif porcentaje_ocupacion >= 85 %}bg-orange-600
                                    {% elif porcentaje_ocupacion >= 70 %}bg-yellow-500
                                    {% elif porcentaje_ocupacion >= 50 %}bg-blue-500
                                    {% else %}bg-green-500{% endif %}"
                                    data-width="{{ porcentaje_ocupacion|default:0 }}" style="width: 0%">
                                    <span class="flex items-center justify-center h-full text-white text-xs font-medium">
                                        {{ porcentaje_ocupacion|default:0 }}%
                                    </span>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-5 gap-2 text-center">
                                <div>
                                    <small class="text-gray-500 block">Excelente</small>
                                    <div class="bg-green-500 h-2 rounded-full"></div>
                                    <small class="text-xs text-gray-600">0-49%</small>
                                </div>
                                <div>
                                    <small class="text-gray-500 block">Bueno</small>
                                    <div class="bg-blue-500 h-2 rounded-full"></div>
                                    <small class="text-xs text-gray-600">50-69%</small>
                                </div>
                                <div>
                                    <small class="text-gray-500 block">Alto</small>
                                    <div class="bg-yellow-500 h-2 rounded-full"></div>
                                    <small class="text-xs text-gray-600">70-84%</small>
                                </div>
                                <div>
                                    <small class="text-gray-500 block">Casi lleno</small>
                                    <div class="bg-orange-600 h-2 rounded-full"></div>
                                    <small class="text-xs text-gray-600">85-99%</small>
                                </div>
                                <div>
                                    <small class="text-gray-500 block">Completo</small>
                                    <div class="bg-red-700 h-2 rounded-full"></div>
                                    <small class="text-xs text-gray-600">100%</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center p-2">
                            {% if porcentaje_ocupacion == 100 %}
                                <svg class="size-14 mx-auto text-red-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18 21l-2.121-2.121m1.414-1.414L21 18m-3-5.196V13a3 3 0 11-6 0c0-.085.002-.17.006-.253M12 7c1.11 0 2.08.402 2.599 1M12 7V3m0 0L9 6m3-3l3 3"></path>
                                </svg>
                                <h6 class="text-red-600 font-semibold text-2xl">Clase Llena</h6>
                                <p class="text-md text-gray-600">¡Deberás crear otra clase!</p>
                            {% elif porcentaje_ocupacion >= 85 %}
                                <svg class="size-14 mx-auto text-red-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                                <h6 class="text-orange-600 font-semibold text-2xl">Clase Casi Llena</h6>
                                <p class="text-md text-gray-600">Considera abrir otra clase</p>
                            {% elif porcentaje_ocupacion >= 70 %}
                                <svg class="size-14 mx-auto text-yellow-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                                <h6 class="text-yellow-600 font-semibold text-2xl">Alta Demanda</h6>
                                <p class="text-md text-gray-600">Monitorea la ocupación</p>
                            {% elif porcentaje_ocupacion >= 50 %}
                                <svg class="size-14 mx-auto text-blue-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path>
                                </svg>
                                <h6 class="text-blue-600 font-semibold text-2xl">Buena Ocupación</h6>
                                <p class="text-md text-gray-600">Clase en buen estado</p>
                            {% else %}
                                <svg class="size-14 mx-auto text-green-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                </svg>
                                <h6 class="text-green-600 font-semibold text-2xl">Cupos Disponibles</h6>
                                <p class="text-md text-gray-600">Acepta más reservas</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Reservations -->
    <div class="grid grid-cols-12 gap-4 mb-4">
        <div class="col-span-12">
            <div class="card">
                <div class="card-header flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-2 sm:space-y-0">
                    <h5 class="text-lg font-semibold text-blanco flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                        Reservas Activas
                        {% if total_reservas %}
                            <span class="inline-block px-2 py-1 bg-secundario text-blanco text-xs font-medium rounded-full ml-2">{{ total_reservas }}</span>
                        {% endif %}
                    </h5>
                    
                    {% if total_reservas %}
                        <div class="flex space-x-2">
                            <button type="button" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 text-sm rounded-lg transition-colors duration-200 flex items-center" onclick="exportReservas()">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Exportar
                            </button>
                            <button type="button" class="bg-secundario hover:bg-secundario/70 text-gray-700 px-3 py-1 text-sm rounded-lg transition-colors duration-200 flex items-center" onclick="printReservas()">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                                </svg>
                                Imprimir
                            </button>
                        </div>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if reservas %}
                        <!-- Desktop Table -->
                        <div class="hidden md:block overflow-x-auto">
                            <table class="w-full table-auto" id="reservasTable">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Usuario</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Contacto</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Fecha de Reserva</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Próxima Clase</th>
                                        <th class="text-center py-3 px-4 font-semibold text-gray-700">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for reserva in reservas %}
                                        <tr class="border-b border-gray-50 hover:bg-gray-50 transition-colors duration-200">
                                            <td class="py-3 px-4">
                                                <div class="flex items-center">
                                                    {% if reserva.usuario.profile.avatar %}
                                                        <img src="{{ reserva.usuario.profile.avatar.url }}" alt="{{ reserva.get_nombre_completo_usuario }}" class="w-10 h-10 rounded-full object-cover mr-3">
                                                    {% else %}
                                                        <div class="w-10 h-10 bg-gradient-to-br from-principal to-secundario text-white rounded-full flex items-center justify-center font-semibold mr-3">
                                                            {{ reserva.usuario.first_name.0|default:reserva.usuario.username.0|upper }}{{ reserva.usuario.last_name.0|default:""|upper }}
                                                        </div>
                                                    {% endif %}
                                                    <div>
                                                        <div class="font-semibold text-gray-800">{{ reserva.get_nombre_completo_usuario }}</div>
                                                        <small class="text-gray-500">@{{ reserva.usuario.username }}</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="py-3 px-4">
                                                <div>
                                                    <div class="mb-1 flex items-center">
                                                        <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                                        </svg>
                                                        <small class="text-gray-600">{{ reserva.usuario.email }}</small>
                                                    </div>
                                                    {% if reserva.usuario.profile.telefono %}
                                                        <div class="flex items-center">
                                                            <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                                            </svg>
                                                            <small class="text-gray-600">{{ reserva.usuario.profile.telefono }}</small>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </td>
                                            <td class="py-3 px-4">
                                                <small class="text-gray-600">{{ reserva.fecha_reserva|date:"d/m/Y H:i" }}</small>
                                            </td>
                                            <td class="py-3 px-4">
                                                <small class="text-green-600 flex items-center">
                                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                    {{ reserva.get_proxima_clase_info }}
                                                </small>
                                            </td>
                                            <td class="py-3 px-4">
                                                <div class="flex space-x-1 justify-center">
                                                    <a href="{% url 'gravity:admin_usuario_detalle' reserva.usuario.id %}" 
                                                    class="btn bg-principal hover:bg-blue-200 text-fondo p-2 rounded-lg transition-colors duration-200" 
                                                    title="Ver usuario">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                                        </svg>
                                                    </a>
                                                    <a href="{% url 'gravity:admin_reserva_cancelar' reserva.id %}" 
                                                    class="btn bg-red-100 hover:bg-red-200 text-red-700 p-2 rounded-lg transition-colors duration-200" 
                                                    title="Cancelar reserva"
                                                    onclick="return confirm('¿Estás seguro de cancelar la reserva de {{ reserva.get_nombre_completo_usuario }}?')">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                        </svg>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Mobile Cards -->
                        <div class="md:hidden space-y-3">
                            {% for reserva in reservas %}
                                <div class="card border border-gray-200 p-2">
                                    <div class="card-body">
                                        <div class="grid grid-cols-3 gap-3">
                                            <div class="flex flex-col items-center justify-center gap-2">
                                                {% if reserva.usuario.profile.avatar %}
                                                    <img src="{{ reserva.usuario.profile.avatar.url }}" alt="{{ reserva.get_nombre_completo_usuario }}" class="w-10 h-10 rounded-full object-cover mr-3">
                                                {% else %}
                                                    <div class="w-10 h-10 bg-gradient-to-br from-principal to-secundario text-white rounded-full flex items-center justify-center font-semibold mr-3">
                                                        {{ reserva.usuario.first_name.0|default:reserva.usuario.username.0|upper }}{{ reserva.usuario.last_name.0|default:""|upper }}
                                                    </div>
                                                {% endif %}
                                                <span class="inline-block px-2 py-1 bg-fondo text-principal text-xs font-medium rounded">@{{ reserva.usuario.username }}</span>
                                            </div>
                                            <div class="col-span-2">
                                                <h6 class="font-semibold text-gray-800 mb-1">{{ reserva.get_nombre_completo_usuario }}</h6>
                                                <div class="space-y-1 text-sm text-gray-600">
                                                    <div class="flex items-center">
                                                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                                        </svg>
                                                        {{ reserva.usuario.email }}
                                                    </div>
                                                    {% if reserva.usuario.profile.telefono %}
                                                        <div class="flex items-center">
                                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                                            </svg>
                                                            {{ reserva.usuario.profile.telefono }}
                                                        </div>
                                                    {% endif %}
                                                    <div class="flex items-center">
                                                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                                        </svg>
                                                        {{ reserva.fecha_reserva|date:"d/m/Y H:i" }}
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-center justify-evenly mt-3">
                                                    <a href="{% url 'gravity:admin_usuario_detalle' reserva.usuario.id %}" 
                                                    class="bg-principal hover:bg-secundario text-fondo p-3 rounded-lg transition-colors duration-200">
                                                        <svg class="size-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                                        </svg>
                                                    </a>
                                                    <a href="{% url 'gravity:admin_reserva_cancelar' reserva.id %}" 
                                                    class="bg-red-100 hover:bg-red-200 text-red-700 p-3 rounded-lg transition-colors duration-200"
                                                    onclick="return confirm('¿Estás seguro de cancelar esta reserva?')">
                                                        <svg class="size-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                        </svg>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Empty State -->
                        <div class="flex flex-col items-center justify-center py-12">
                            <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                            </svg>
                            <h4 class="text-xl text-gray-500 font-semibold mb-3">No hay reservas activas</h4>
                            <p class="text-gray-500 mb-4">Esta clase aún no tiene usuarios inscritos.</p>
                            
                            {% if not clase.activa %}
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4 max-w-[80%]">
                                    <div class="flex items-center justify-center">
                                        <svg class="w-5 h-5 text-yellow-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                        <strong class="text-yellow-800">Nota:</strong>
                                        <span class="text-yellow-700 ml-1">Esta clase está inactiva, por lo que los usuarios no pueden hacer nuevas reservas.</span>
                                    </div>
                                </div>
                            {% endif %}
                            
                            <a href="{% url 'gravity:admin_agregar_cliente_no_registrado' %}?clase_id={{ clase.id }}" 
                            class="btn bg-principal hover:bg-principal/90 text-white px-6 py-3 rounded-lg transition-colors duration-200 inline-flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Agregar Cliente Manualmente
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-12 gap-4">
        <div class="col-span-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="text-lg font-semibold text-blanco flex items-center gap-2">
                        <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Acciones Rápidas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-3">
                        <div>
                            <h6 class="text-base font-semibold mb-3 text-gray-700">Gestión de Clase:</h6>
                            <div class="space-y-2">
                                <a href="{% url 'gravity:admin_clase_editar' clase.id %}" 
                                class="btn w-full bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 px-4 py-3 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1">
                                    <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                    Editar Información
                                </a>
                                
                                {% if clase.activa %}
                                    <button class="w-full bg-yellow-50 hover:bg-yellow-100 text-yellow-700 border border-yellow-200 px-4 py-3 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1" 
                                            onclick="toggleClaseStatus(false)">
                                        <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Desactivar Clase
                                    </button>
                                {% else %}
                                    <button class="w-full bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 px-4 py-3 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1" 
                                            onclick="toggleClaseStatus(true)">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                                        </svg>
                                        Activar Clase
                                    </button>
                                {% endif %}
                                
                                {% if clase.puede_eliminarse %}
                                    <a href="{% url 'gravity:admin_clase_eliminar' clase.id %}" 
                                    class="w-full bg-red-50 hover:bg-red-100 text-red-700 border border-red-200 px-4 py-3 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1">
                                        <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                        Eliminar Clase
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div>
                            <h6 class="text-base font-semibold mb-3 text-gray-700">Gestión de Usuarios:</h6>
                            <div class="space-y-2">
                                <a href="{% url 'gravity:admin_agregar_cliente_no_registrado' %}?clase_id={{ clase.id }}" 
                                class="btn w-full bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 px-4 py-3 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1">
                                    <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Agregar Cliente
                                </a>
                                
                                <a href="{% url 'gravity:admin_reservas_lista' %}?tipo_clase={{ clase.tipo }}&dia={{ clase.dia }}" 
                                class="w-full bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 px-4 py-3 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1">
                                    <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                                    </svg>
                                    Ver Todas las Reservas
                                </a>
                                
                                <a href="{% url 'gravity:admin_usuarios_lista' %}" 
                                class="w-full bg-gray-50 hover:bg-gray-100 text-gray-700 border border-gray-200 px-4 py-3 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                                    </svg>
                                    Gestionar Usuarios
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animate progress bar
            const progressBar = document.querySelector('[data-width]');
            if (progressBar) {
                const width = progressBar.dataset.width + '%';
                progressBar.style.width = '0%';
                setTimeout(function() {
                    progressBar.style.width = width;
                }, 500);
            }
            
            // Auto-refresh data every 5 minutes
            setInterval(function() {
                location.reload();
            }, 300000);
        });

        // Function to toggle class status
        function toggleClaseStatus(newStatus) {
            const action = newStatus ? 'activar' : 'desactivar';
            const className = '{{ clase.get_tipo_display }} - {{ clase.dia }} {{ clase.horario|time:"H:i" }}';
            
            if (confirm('¿Estás seguro de que quieres ' + action + ' la clase "' + className + '"?')) {
                window.location.href = '{% url "gravity:admin_clase_editar" clase.id %}';
            }
        }

        // Function to export reservations
        function exportReservas() {
            const table = document.getElementById('reservasTable');
            if (!table) return;
            
            let csv = 'Usuario,Email,Teléfono,Número de Reserva,Fecha de Reserva\n';
            
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(function(row) {
                const cells = row.querySelectorAll('td');
                const usuario = cells[0].querySelector('.font-semibold').textContent;
                const email = cells[1].querySelector('small').textContent;
                const telefono = cells[1].querySelectorAll('small')[1] ? 
                                cells[1].querySelectorAll('small')[1].textContent : 'N/A';
                const reserva = cells[2].textContent.trim();
                const fecha = cells[3].textContent.trim();
                
                csv += usuario + ',' + email + ',' + telefono + ',' + reserva + ',' + fecha + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reservas_{{ clase.tipo }}_{{ clase.dia }}_{{ clase.horario|time:"H-i" }}.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Function to print reservations
        function printReservas() {
            const printWindow = window.open('', '_blank');
            const className = '{{ clase.get_tipo_display }} - {{ clase.dia }} {{ clase.horario|time:"H:i" }}';
            
            let printContent = '<html><head><title>Reservas - ' + className + '</title>';
            printContent += '<style>body{font-family:Arial,sans-serif;} table{border-collapse:collapse;width:100%;} th,td{border:1px solid #ddd;padding:8px;text-align:left;} th{background-color:#f2f2f2;}</style>';
            printContent += '</head><body>';
            printContent += '<h1>Reservas - ' + className + '</h1>';
            printContent += '<p>Fecha de impresión: ' + new Date().toLocaleDateString() + '</p>';
            
            const table = document.getElementById('reservasTable');
            if (table) {
                printContent += table.outerHTML;
            }
            
            printContent += '</body></html>';
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }
    </script>
{% endblock %}